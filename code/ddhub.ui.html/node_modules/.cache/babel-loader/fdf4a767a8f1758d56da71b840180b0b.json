{"ast":null,"code":"/*\n * Copyright (c) 2010-2019 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { arrays, dragAndDrop, files as fileUtil, MessageBoxes, Status } from '../index';\nimport $ from 'jquery';\nexport default class DragAndDropHandler {\n  constructor(options) {\n    options = options || {};\n    this.additionalDropProperties = null;\n    this.allowedTypes = null;\n    this.dropMaximumSize = null;\n    this.target = null;\n    this.onDrop = null;\n    this.validateFiles = null;\n    $.extend(this, options);\n    this.supportedScoutTypes = arrays.ensure(options.supportedScoutTypes);\n    this._onDragEnterHandler = this._onDragEnter.bind(this);\n    this._onDragOverHandler = this._onDragOver.bind(this);\n    this._onDropHandler = this._onDrop.bind(this);\n  }\n  install($element, selector) {\n    if (this.$element) {\n      throw new Error('Already installed.');\n    }\n    this.selector = selector;\n    this.$element = $element;\n    this.$element.on('dragenter', this.selector, this._onDragEnterHandler).on('dragover', this.selector, this._onDragOverHandler).on('drop', this.selector, this._onDropHandler);\n  }\n  uninstall() {\n    this.$element.off('dragenter', this.selector, this._onDragEnterHandler).off('dragover', this.selector, this._onDragOverHandler).off('drop', this.selector, this._onDropHandler);\n    this.$element = null;\n    this.selector = null;\n  }\n  _onDragEnter(event) {\n    this._onDragEnterOrOver(event);\n  }\n  _onDragOver(event) {\n    this._onDragEnterOrOver(event);\n  }\n  _onDragEnterOrOver(event) {\n    // set dropEffect to copy. otherwise outlook will move dropped mails into the deleted files folder.\n    // see: https://bugs.chromium.org/p/chromium/issues/detail?id=322605#c33\n    event.originalEvent.dataTransfer.dropEffect = 'copy';\n    dragAndDrop.verifyDataTransferTypesScoutTypes(event, this.supportedScoutTypes, this.dropType());\n  }\n  _onDrop(event) {\n    if (this.supportedScoutTypes.indexOf(dragAndDrop.SCOUT_TYPES.FILE_TRANSFER) >= 0 && (this.dropType() & dragAndDrop.SCOUT_TYPES.FILE_TRANSFER) === dragAndDrop.SCOUT_TYPES.FILE_TRANSFER &&\n    // NOSONAR\n    dragAndDrop.dataTransferTypesContainsScoutTypes(event.originalEvent.dataTransfer, dragAndDrop.SCOUT_TYPES.FILE_TRANSFER)) {\n      if (!this.onDrop || !(event.originalEvent.dataTransfer.files instanceof FileList)) {\n        return;\n      }\n      let files = fileUtil.fileListToArray(event.originalEvent.dataTransfer.files);\n      if (arrays.empty(files)) {\n        return;\n      }\n      try {\n        this.validateFiles(files, this._validateFiles.bind(this));\n      } catch (error) {\n        this._validationFailed(error);\n        return;\n      }\n      event.stopPropagation();\n      event.preventDefault();\n      this.onDrop({\n        originalEvent: event,\n        files: files\n      });\n    }\n  }\n\n  /**\n   *\n   * @param {File[]} files\n   * @private\n   * @throws {dropValidationErrorMessage} validationErrorMessage\n   */\n  _validateFiles(files) {\n    if (!this.dropMaximumSize) {\n      return;\n    }\n    let dropMaximumSize = this.dropMaximumSize();\n    if (!fileUtil.validateMaximumUploadSize(files, dropMaximumSize)) {\n      throw {\n        title: this.target.session.text('ui.FileSizeLimitTitle'),\n        message: this.target.session.text('ui.FileSizeLimit', dropMaximumSize / 1024 / 1024)\n      };\n    }\n  }\n\n  /**\n   * @param {dropValidationErrorMessage} error\n   */\n  _validationFailed(error) {\n    $.log.isDebugEnabled() && $.log.debug('File validation failed', error);\n    let title = '';\n    let message = 'Invalid files';\n    if (error) {\n      title = error.title || title;\n      message = error.message || message;\n    }\n    return MessageBoxes.createOk(this.target).withSeverity(Status.Severity.ERROR).withHeader(title).withBody(message).buildAndOpen();\n  }\n  uploadFiles(event) {\n    if (event && event.originalEvent && event.files.length >= 1) {\n      this.target.session.uploadFiles(this.target, event.files, this.additionalDropProperties ? this.additionalDropProperties(event.originalEvent) : undefined, this.dropMaximumSize ? this.dropMaximumSize() : undefined, this.allowedTypes ? this.allowedTypes() : undefined);\n    }\n  }\n\n  // ----------------- TYPEDEF -----------------\n\n  /**\n   * @typedef dropValidationErrorMessage\n   * @property {string} title\n   * @property {string} message\n   */\n}","map":{"version":3,"names":["arrays","dragAndDrop","files","fileUtil","MessageBoxes","Status","$","DragAndDropHandler","constructor","options","additionalDropProperties","allowedTypes","dropMaximumSize","target","onDrop","validateFiles","extend","supportedScoutTypes","ensure","_onDragEnterHandler","_onDragEnter","bind","_onDragOverHandler","_onDragOver","_onDropHandler","_onDrop","install","$element","selector","Error","on","uninstall","off","event","_onDragEnterOrOver","originalEvent","dataTransfer","dropEffect","verifyDataTransferTypesScoutTypes","dropType","indexOf","SCOUT_TYPES","FILE_TRANSFER","dataTransferTypesContainsScoutTypes","FileList","fileListToArray","empty","_validateFiles","error","_validationFailed","stopPropagation","preventDefault","validateMaximumUploadSize","title","session","text","message","log","isDebugEnabled","debug","createOk","withSeverity","Severity","ERROR","withHeader","withBody","buildAndOpen","uploadFiles","length","undefined"],"sources":["C:/git/d-d-hub/code/node_modules/.pnpm/@eclipse-scout+core@22.0.41/node_modules/@eclipse-scout/core/src/util/DragAndDropHandler.js"],"sourcesContent":["/*\n * Copyright (c) 2010-2019 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {arrays, dragAndDrop, files as fileUtil, MessageBoxes, Status} from '../index';\nimport $ from 'jquery';\n\nexport default class DragAndDropHandler {\n\n  constructor(options) {\n    options = options || {};\n    this.additionalDropProperties = null;\n    this.allowedTypes = null;\n    this.dropMaximumSize = null;\n    this.target = null;\n    this.onDrop = null;\n    this.validateFiles = null;\n\n    $.extend(this, options);\n    this.supportedScoutTypes = arrays.ensure(options.supportedScoutTypes);\n    this._onDragEnterHandler = this._onDragEnter.bind(this);\n    this._onDragOverHandler = this._onDragOver.bind(this);\n    this._onDropHandler = this._onDrop.bind(this);\n  }\n\n  install($element, selector) {\n    if (this.$element) {\n      throw new Error('Already installed.');\n    }\n    this.selector = selector;\n    this.$element = $element;\n    this.$element.on('dragenter', this.selector, this._onDragEnterHandler)\n      .on('dragover', this.selector, this._onDragOverHandler)\n      .on('drop', this.selector, this._onDropHandler);\n  }\n\n  uninstall() {\n    this.$element.off('dragenter', this.selector, this._onDragEnterHandler)\n      .off('dragover', this.selector, this._onDragOverHandler)\n      .off('drop', this.selector, this._onDropHandler);\n    this.$element = null;\n    this.selector = null;\n  }\n\n  _onDragEnter(event) {\n    this._onDragEnterOrOver(event);\n  }\n\n  _onDragOver(event) {\n    this._onDragEnterOrOver(event);\n  }\n\n  _onDragEnterOrOver(event) {\n    // set dropEffect to copy. otherwise outlook will move dropped mails into the deleted files folder.\n    // see: https://bugs.chromium.org/p/chromium/issues/detail?id=322605#c33\n    event.originalEvent.dataTransfer.dropEffect = 'copy';\n    dragAndDrop.verifyDataTransferTypesScoutTypes(event, this.supportedScoutTypes, this.dropType());\n  }\n\n  _onDrop(event) {\n    if (this.supportedScoutTypes.indexOf(dragAndDrop.SCOUT_TYPES.FILE_TRANSFER) >= 0 &&\n      (this.dropType() & dragAndDrop.SCOUT_TYPES.FILE_TRANSFER) === dragAndDrop.SCOUT_TYPES.FILE_TRANSFER && // NOSONAR\n      dragAndDrop.dataTransferTypesContainsScoutTypes(event.originalEvent.dataTransfer, dragAndDrop.SCOUT_TYPES.FILE_TRANSFER)) {\n      if (!this.onDrop ||\n        !(event.originalEvent.dataTransfer.files instanceof FileList)) {\n        return;\n      }\n      let files = fileUtil.fileListToArray(event.originalEvent.dataTransfer.files);\n      if (arrays.empty(files)) {\n        return;\n      }\n      try {\n        this.validateFiles(files, this._validateFiles.bind(this));\n      } catch (error) {\n        this._validationFailed(error);\n        return;\n      }\n      event.stopPropagation();\n      event.preventDefault();\n      this.onDrop({\n        originalEvent: event,\n        files: files\n      });\n    }\n  }\n\n  /**\n   *\n   * @param {File[]} files\n   * @private\n   * @throws {dropValidationErrorMessage} validationErrorMessage\n   */\n  _validateFiles(files) {\n    if (!this.dropMaximumSize) {\n      return;\n    }\n    let dropMaximumSize = this.dropMaximumSize();\n    if (!fileUtil.validateMaximumUploadSize(files, dropMaximumSize)) {\n      throw {\n        title: this.target.session.text('ui.FileSizeLimitTitle'),\n        message: this.target.session.text('ui.FileSizeLimit', (dropMaximumSize / 1024 / 1024))\n      };\n    }\n  }\n\n  /**\n   * @param {dropValidationErrorMessage} error\n   */\n  _validationFailed(error) {\n    $.log.isDebugEnabled() && $.log.debug('File validation failed', error);\n    let title = '';\n    let message = 'Invalid files';\n    if (error) {\n      title = error.title || title;\n      message = error.message || message;\n    }\n    return MessageBoxes.createOk(this.target)\n      .withSeverity(Status.Severity.ERROR)\n      .withHeader(title)\n      .withBody(message)\n      .buildAndOpen();\n  }\n\n  uploadFiles(event) {\n    if (event && event.originalEvent && event.files.length >= 1) {\n      this.target.session.uploadFiles(this.target, event.files,\n        this.additionalDropProperties ? this.additionalDropProperties(event.originalEvent) : undefined,\n        this.dropMaximumSize ? this.dropMaximumSize() : undefined,\n        this.allowedTypes ? this.allowedTypes() : undefined);\n    }\n  }\n\n  // ----------------- TYPEDEF -----------------\n\n  /**\n   * @typedef dropValidationErrorMessage\n   * @property {string} title\n   * @property {string} message\n   */\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}