{"ast":null,"code":"/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { Device, events, HtmlComponent, keys, scout, Widget } from '../index';\nexport default class IFrame extends Widget {\n  constructor() {\n    super();\n    this.location = null;\n    this.sandboxEnabled = true;\n    this.sandboxPermissions = null;\n    this.scrollBarEnabled = true;\n    this.trackLocation = false;\n    // Iframe on iOS is always as big as its content. Workaround it by using a wrapper div with overflow: auto\n    // Don't wrap it when running in the chrome emulator (in that case isIosPlatform returns false)\n    this.wrapIframe = Device.get().isIosPlatform();\n    this.$iframe = null;\n  }\n  _render() {\n    let cssClass = 'iframe ' + Device.get().cssClassForIphone();\n    // Inserting an IFrame starts the processing of the micro task queue in Safari.\n    // This must not happen during rendering because it could trigger render again for elements being rendered (some layouts render parts of the widget, e.g. widgets with virtual scrolling)\n    this.session.layoutValidator.suppressValidate();\n    if (this.wrapIframe) {\n      this.$container = this.$parent.appendDiv('iframe-wrapper');\n      this.$iframe = this.$container.appendElement('<iframe>', cssClass);\n    } else {\n      this.$iframe = this.$parent.appendElement('<iframe>', cssClass);\n      this.$container = this.$iframe;\n    }\n    this.session.layoutValidator.unsuppressValidate();\n    this.htmlComp = HtmlComponent.install(this.$container, this.session);\n    this.$iframe.on('load', this._onLoad.bind(this));\n  }\n\n  /**\n   * @override ValueField.js\n   */\n  _renderProperties() {\n    super._renderProperties();\n    this._renderScrollBarEnabled();\n    this._renderSandboxEnabled(); // includes _renderSandboxPermissions()\n    this._renderLocation(); // Needs to be after _renderScrollBarEnabled and _renderSandboxEnabled, see comment in _renderScrollBarEnabled\n  }\n\n  setLocation(location) {\n    this.setProperty('location', location);\n  }\n  _renderLocation() {\n    // Convert empty locations to 'about:blank', because in Firefox (maybe others, too?),\n    // empty locations simply remove the src attribute but don't remove the old content.\n    let location = this.location || 'about:blank';\n    this.$iframe.attr('src', location);\n  }\n  setTrackLocation(trackLocation) {\n    this.setProperty('trackLocation', trackLocation);\n  }\n  _contentDocument() {\n    if (this.$iframe && this.$iframe[0]) {\n      return this.$iframe[0].contentDocument;\n    }\n    return null;\n  }\n  _onLoad(event) {\n    if (!this.rendered) {\n      // check needed, because this is an async callback\n      return;\n    }\n    if (this.trackLocation) {\n      this._updateLocation();\n    }\n    this._propagateKeyEvents();\n  }\n  _updateLocation() {\n    let doc = this._contentDocument();\n    if (!doc) {\n      // Doc can be null if website cannot be loaded or if website is not from same origin\n      return;\n    }\n    let location = doc.location.href;\n    if (location === 'about:blank') {\n      location = null;\n    }\n    this._setProperty('location', location);\n  }\n\n  /**\n   * Make key strokes work even if pressed in the iframe\n   */\n  _propagateKeyEvents() {\n    let source = this._contentDocument();\n    if (!source) {\n      return;\n    }\n    let target = this.wrapIframe ? this.$container[0] : this.$parent[0];\n    if (!target) {\n      return;\n    }\n    events.addPropagationListener(source, target, ['keydown', 'keyup', 'keypress'], event => {\n      // Don't propagate TAB key strokes otherwise it would break tabbing inside the document.\n      return event.which !== keys.TAB;\n    });\n  }\n  setScrollBarEnabled(scrollBarEnabled) {\n    this.setProperty('scrollBarEnabled', scrollBarEnabled);\n  }\n  _renderScrollBarEnabled() {\n    this.$container.toggleClass('no-scrolling', !this.scrollBarEnabled);\n    // According to http://stackoverflow.com/a/18470016, setting 'overflow: hidden' via\n    // CSS should be enough. However, if the inner page sets 'overflow' to another value,\n    // scroll bars are shown again. Therefore, we add the legacy 'scrolling' attribute,\n    // which is deprecated in HTML5, but seems to do the trick.\n    this.$iframe.attr('scrolling', this.scrollBarEnabled ? 'yes' : 'no');\n\n    // re-render location otherwise the attribute change would have no effect, see\n    // https://html.spec.whatwg.org/multipage/embedded-content.html#attr-iframe-sandbox\n    if (this.rendered) {\n      this._renderLocation();\n    }\n  }\n  setSandboxEnabled(sandboxEnabled) {\n    this.setProperty('sandboxEnabled', sandboxEnabled);\n  }\n  _renderSandboxEnabled() {\n    if (this.sandboxEnabled) {\n      this._renderSandboxPermissions();\n    } else {\n      this.$iframe.removeAttr('sandbox');\n      this.$iframe.removeAttr('security');\n    }\n    // re-render location otherwise the attribute change would have no effect, see\n    // https://html.spec.whatwg.org/multipage/embedded-content.html#attr-iframe-sandbox\n    if (this.rendered) {\n      this._renderLocation();\n    }\n  }\n  setSandboxPermissions(sandboxPermissions) {\n    this.setProperty('sandboxPermissions', sandboxPermissions);\n  }\n  _renderSandboxPermissions() {\n    if (!this.sandboxEnabled) {\n      return;\n    }\n    this.$iframe.attr('sandbox', scout.nvl(this.sandboxPermissions, ''));\n    // re-render location otherwise the attribute change would have no effect, see\n    // https://html.spec.whatwg.org/multipage/embedded-content.html#attr-iframe-sandbox\n    if (this.rendered) {\n      this._renderLocation();\n    }\n  }\n  postMessage(message, targetOrigin) {\n    if (!this.rendered) {\n      return;\n    }\n    this.$iframe[0].contentWindow.postMessage(message, targetOrigin);\n  }\n}","map":{"version":3,"names":["Device","events","HtmlComponent","keys","scout","Widget","IFrame","constructor","location","sandboxEnabled","sandboxPermissions","scrollBarEnabled","trackLocation","wrapIframe","get","isIosPlatform","$iframe","_render","cssClass","cssClassForIphone","session","layoutValidator","suppressValidate","$container","$parent","appendDiv","appendElement","unsuppressValidate","htmlComp","install","on","_onLoad","bind","_renderProperties","_renderScrollBarEnabled","_renderSandboxEnabled","_renderLocation","setLocation","setProperty","attr","setTrackLocation","_contentDocument","contentDocument","event","rendered","_updateLocation","_propagateKeyEvents","doc","href","_setProperty","source","target","addPropagationListener","which","TAB","setScrollBarEnabled","toggleClass","setSandboxEnabled","_renderSandboxPermissions","removeAttr","setSandboxPermissions","nvl","postMessage","message","targetOrigin","contentWindow"],"sources":["C:/workspace/ddhub/ddhub/node_modules/.pnpm/@eclipse-scout+core@22.0.41/node_modules/@eclipse-scout/core/src/iframe/IFrame.js"],"sourcesContent":["/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {Device, events, HtmlComponent, keys, scout, Widget} from '../index';\n\nexport default class IFrame extends Widget {\n\n  constructor() {\n    super();\n\n    this.location = null;\n    this.sandboxEnabled = true;\n    this.sandboxPermissions = null;\n    this.scrollBarEnabled = true;\n    this.trackLocation = false;\n    // Iframe on iOS is always as big as its content. Workaround it by using a wrapper div with overflow: auto\n    // Don't wrap it when running in the chrome emulator (in that case isIosPlatform returns false)\n    this.wrapIframe = Device.get().isIosPlatform();\n    this.$iframe = null;\n  }\n\n  _render() {\n    let cssClass = 'iframe ' + Device.get().cssClassForIphone();\n    // Inserting an IFrame starts the processing of the micro task queue in Safari.\n    // This must not happen during rendering because it could trigger render again for elements being rendered (some layouts render parts of the widget, e.g. widgets with virtual scrolling)\n    this.session.layoutValidator.suppressValidate();\n    if (this.wrapIframe) {\n      this.$container = this.$parent.appendDiv('iframe-wrapper');\n      this.$iframe = this.$container.appendElement('<iframe>', cssClass);\n    } else {\n      this.$iframe = this.$parent.appendElement('<iframe>', cssClass);\n      this.$container = this.$iframe;\n    }\n    this.session.layoutValidator.unsuppressValidate();\n    this.htmlComp = HtmlComponent.install(this.$container, this.session);\n\n    this.$iframe.on('load', this._onLoad.bind(this));\n  }\n\n  /**\n   * @override ValueField.js\n   */\n  _renderProperties() {\n    super._renderProperties();\n    this._renderScrollBarEnabled();\n    this._renderSandboxEnabled(); // includes _renderSandboxPermissions()\n    this._renderLocation(); // Needs to be after _renderScrollBarEnabled and _renderSandboxEnabled, see comment in _renderScrollBarEnabled\n  }\n\n  setLocation(location) {\n    this.setProperty('location', location);\n  }\n\n  _renderLocation() {\n    // Convert empty locations to 'about:blank', because in Firefox (maybe others, too?),\n    // empty locations simply remove the src attribute but don't remove the old content.\n    let location = this.location || 'about:blank';\n    this.$iframe.attr('src', location);\n  }\n\n  setTrackLocation(trackLocation) {\n    this.setProperty('trackLocation', trackLocation);\n  }\n\n  _contentDocument() {\n    if (this.$iframe && this.$iframe[0]) {\n      return this.$iframe[0].contentDocument;\n    }\n    return null;\n  }\n\n  _onLoad(event) {\n    if (!this.rendered) { // check needed, because this is an async callback\n      return;\n    }\n    if (this.trackLocation) {\n      this._updateLocation();\n    }\n    this._propagateKeyEvents();\n  }\n\n  _updateLocation() {\n    let doc = this._contentDocument();\n    if (!doc) {\n      // Doc can be null if website cannot be loaded or if website is not from same origin\n      return;\n    }\n    let location = doc.location.href;\n    if (location === 'about:blank') {\n      location = null;\n    }\n    this._setProperty('location', location);\n  }\n\n  /**\n   * Make key strokes work even if pressed in the iframe\n   */\n  _propagateKeyEvents() {\n    let source = this._contentDocument();\n    if (!source) {\n      return;\n    }\n    let target = (this.wrapIframe ? this.$container[0] : this.$parent[0]);\n    if (!target) {\n      return;\n    }\n    events.addPropagationListener(source, target, ['keydown', 'keyup', 'keypress'], event => {\n      // Don't propagate TAB key strokes otherwise it would break tabbing inside the document.\n      return event.which !== keys.TAB;\n    });\n  }\n\n  setScrollBarEnabled(scrollBarEnabled) {\n    this.setProperty('scrollBarEnabled', scrollBarEnabled);\n  }\n\n  _renderScrollBarEnabled() {\n    this.$container.toggleClass('no-scrolling', !this.scrollBarEnabled);\n    // According to http://stackoverflow.com/a/18470016, setting 'overflow: hidden' via\n    // CSS should be enough. However, if the inner page sets 'overflow' to another value,\n    // scroll bars are shown again. Therefore, we add the legacy 'scrolling' attribute,\n    // which is deprecated in HTML5, but seems to do the trick.\n    this.$iframe.attr('scrolling', (this.scrollBarEnabled ? 'yes' : 'no'));\n\n    // re-render location otherwise the attribute change would have no effect, see\n    // https://html.spec.whatwg.org/multipage/embedded-content.html#attr-iframe-sandbox\n    if (this.rendered) {\n      this._renderLocation();\n    }\n  }\n\n  setSandboxEnabled(sandboxEnabled) {\n    this.setProperty('sandboxEnabled', sandboxEnabled);\n  }\n\n  _renderSandboxEnabled() {\n    if (this.sandboxEnabled) {\n      this._renderSandboxPermissions();\n    } else {\n      this.$iframe.removeAttr('sandbox');\n      this.$iframe.removeAttr('security');\n    }\n    // re-render location otherwise the attribute change would have no effect, see\n    // https://html.spec.whatwg.org/multipage/embedded-content.html#attr-iframe-sandbox\n    if (this.rendered) {\n      this._renderLocation();\n    }\n  }\n\n  setSandboxPermissions(sandboxPermissions) {\n    this.setProperty('sandboxPermissions', sandboxPermissions);\n  }\n\n  _renderSandboxPermissions() {\n    if (!this.sandboxEnabled) {\n      return;\n    }\n    this.$iframe.attr('sandbox', scout.nvl(this.sandboxPermissions, ''));\n    // re-render location otherwise the attribute change would have no effect, see\n    // https://html.spec.whatwg.org/multipage/embedded-content.html#attr-iframe-sandbox\n    if (this.rendered) {\n      this._renderLocation();\n    }\n  }\n\n  postMessage(message, targetOrigin) {\n    if (!this.rendered) {\n      return;\n    }\n    this.$iframe[0].contentWindow.postMessage(message, targetOrigin);\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}