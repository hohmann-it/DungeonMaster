{"ast":null,"code":"/*\n * Copyright (c) 2010-2020 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { AppLinkKeyStroke, scrollbars, ValueField } from '../../../index';\nimport $ from 'jquery';\nexport default class HtmlField extends ValueField {\n  constructor() {\n    super();\n    this.scrollBarEnabled = false;\n    this.preventInitialFocus = true;\n    this.selectable = true;\n  }\n\n  /**\n   * @override FormField.js\n   */\n  _initKeyStrokeContext() {\n    super._initKeyStrokeContext();\n    this.keyStrokeContext.registerKeyStroke(new AppLinkKeyStroke(this, this._onAppLinkAction));\n  }\n  _render() {\n    this.addContainer(this.$parent, 'html-field');\n    this.addLabel();\n    this.addField(this.$parent.makeDiv());\n    this.addStatus();\n  }\n  _renderProperties() {\n    super._renderProperties();\n    this._renderScrollBarEnabled();\n    this._renderScrollToAnchor();\n    this._renderSelectable();\n  }\n  _readDisplayText() {\n    return this.$field.html();\n  }\n\n  /**\n   * @override\n   */\n  _renderDisplayText() {\n    if (!this.displayText) {\n      this.$field.empty();\n      return;\n    }\n    this.$field.html(this.displayText);\n\n    // Add action to app-links\n    this.$field.find('.app-link').on('click', this._onAppLinkAction.bind(this));\n\n    // Don't change focus when a link is clicked by mouse\n    this.$field.find('a, .app-link').attr('tabindex', '0').unfocusable();\n\n    // Add listener to images to update the layout when the images are loaded\n    this.$field.find('img').on('load', this._onImageLoad.bind(this)).on('error', this._onImageError.bind(this));\n\n    // Because this method replaces the content, the scroll bars might have to be added or removed\n    if (this.rendered) {\n      // (only necessary if already rendered, otherwise it is done by renderProperties)\n      this._uninstallScrollbars();\n      this._renderScrollBarEnabled();\n    }\n    this.invalidateLayoutTree();\n  }\n\n  /**\n   * @override\n   */\n  _renderFocused() {\n    // NOP, don't add \"focused\" class. It doesn't look good when the label is highlighted but no cursor is visible.\n  }\n  setScrollBarEnabled(scrollBarEnabled) {\n    this.setProperty('scrollBarEnabled', scrollBarEnabled);\n  }\n  _renderScrollBarEnabled() {\n    if (this.scrollBarEnabled) {\n      this._installScrollbars();\n    } else {\n      this._uninstallScrollbars();\n    }\n  }\n  _renderScrollToAnchor() {\n    if (!this.rendered) {\n      this.session.layoutValidator.schedulePostValidateFunction(this._renderScrollToAnchor.bind(this));\n      return;\n    }\n    let anchor = this.scrollToAnchor;\n    if (this.scrollBarEnabled && anchor && this.$field.find(anchor)) {\n      let anchorElem = this.$field.find('#'.concat(anchor));\n      if (anchorElem && anchorElem.length > 0) {\n        scrollbars.scrollTo(this.$field, anchorElem);\n      }\n    }\n  }\n  setSelectable(selectable) {\n    this.setProperty('selectable', selectable);\n  }\n  _renderSelectable() {\n    this.$container.toggleClass('selectable', !!this.selectable);\n    // Allow this field to receive the focus when selecting text with the mouse. Otherwise, form\n    // keystrokes would no longer work because the focus would automatically be set to the desktop\n    // for lack of alternatives. The value -1 ensures the field is skipped when tabbing through\n    // all form fields.\n    this.$field.toggleAttr('tabindex', !!this.selectable, '-1');\n  }\n  _onAppLinkAction(event) {\n    let $target = $(event.delegateTarget);\n    let ref = $target.data('ref');\n    this.triggerAppLinkAction(ref);\n  }\n  triggerAppLinkAction(ref) {\n    this.trigger('appLinkAction', {\n      ref: ref\n    });\n  }\n  _onImageLoad(event) {\n    this.invalidateLayoutTree();\n  }\n  _onImageError(event) {\n    this.invalidateLayoutTree();\n  }\n}","map":{"version":3,"names":["AppLinkKeyStroke","scrollbars","ValueField","$","HtmlField","constructor","scrollBarEnabled","preventInitialFocus","selectable","_initKeyStrokeContext","keyStrokeContext","registerKeyStroke","_onAppLinkAction","_render","addContainer","$parent","addLabel","addField","makeDiv","addStatus","_renderProperties","_renderScrollBarEnabled","_renderScrollToAnchor","_renderSelectable","_readDisplayText","$field","html","_renderDisplayText","displayText","empty","find","on","bind","attr","unfocusable","_onImageLoad","_onImageError","rendered","_uninstallScrollbars","invalidateLayoutTree","_renderFocused","setScrollBarEnabled","setProperty","_installScrollbars","session","layoutValidator","schedulePostValidateFunction","anchor","scrollToAnchor","anchorElem","concat","length","scrollTo","setSelectable","$container","toggleClass","toggleAttr","event","$target","delegateTarget","ref","data","triggerAppLinkAction","trigger"],"sources":["C:/workspace/ddhub/ddhub/node_modules/.pnpm/@eclipse-scout+core@22.0.41/node_modules/@eclipse-scout/core/src/form/fields/htmlfield/HtmlField.js"],"sourcesContent":["/*\n * Copyright (c) 2010-2020 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {AppLinkKeyStroke, scrollbars, ValueField} from '../../../index';\nimport $ from 'jquery';\n\nexport default class HtmlField extends ValueField {\n\n  constructor() {\n    super();\n    this.scrollBarEnabled = false;\n    this.preventInitialFocus = true;\n    this.selectable = true;\n  }\n\n  /**\n   * @override FormField.js\n   */\n  _initKeyStrokeContext() {\n    super._initKeyStrokeContext();\n\n    this.keyStrokeContext.registerKeyStroke(new AppLinkKeyStroke(this, this._onAppLinkAction));\n  }\n\n  _render() {\n    this.addContainer(this.$parent, 'html-field');\n    this.addLabel();\n\n    this.addField(this.$parent.makeDiv());\n    this.addStatus();\n  }\n\n  _renderProperties() {\n    super._renderProperties();\n\n    this._renderScrollBarEnabled();\n    this._renderScrollToAnchor();\n    this._renderSelectable();\n  }\n\n  _readDisplayText() {\n    return this.$field.html();\n  }\n\n  /**\n   * @override\n   */\n  _renderDisplayText() {\n    if (!this.displayText) {\n      this.$field.empty();\n      return;\n    }\n    this.$field.html(this.displayText);\n\n    // Add action to app-links\n    this.$field.find('.app-link')\n      .on('click', this._onAppLinkAction.bind(this));\n\n    // Don't change focus when a link is clicked by mouse\n    this.$field.find('a, .app-link')\n      .attr('tabindex', '0')\n      .unfocusable();\n\n    // Add listener to images to update the layout when the images are loaded\n    this.$field.find('img')\n      .on('load', this._onImageLoad.bind(this))\n      .on('error', this._onImageError.bind(this));\n\n    // Because this method replaces the content, the scroll bars might have to be added or removed\n    if (this.rendered) { // (only necessary if already rendered, otherwise it is done by renderProperties)\n      this._uninstallScrollbars();\n      this._renderScrollBarEnabled();\n    }\n\n    this.invalidateLayoutTree();\n  }\n\n  /**\n   * @override\n   */\n  _renderFocused() {\n    // NOP, don't add \"focused\" class. It doesn't look good when the label is highlighted but no cursor is visible.\n  }\n\n  setScrollBarEnabled(scrollBarEnabled) {\n    this.setProperty('scrollBarEnabled', scrollBarEnabled);\n  }\n\n  _renderScrollBarEnabled() {\n    if (this.scrollBarEnabled) {\n      this._installScrollbars();\n    } else {\n      this._uninstallScrollbars();\n    }\n  }\n\n  _renderScrollToAnchor() {\n    if (!this.rendered) {\n      this.session.layoutValidator.schedulePostValidateFunction(this._renderScrollToAnchor.bind(this));\n      return;\n    }\n    let anchor = this.scrollToAnchor;\n    if (this.scrollBarEnabled && anchor && this.$field.find(anchor)) {\n      let anchorElem = this.$field.find('#'.concat(anchor));\n      if (anchorElem && anchorElem.length > 0) {\n        scrollbars.scrollTo(this.$field, anchorElem);\n      }\n    }\n  }\n\n  setSelectable(selectable) {\n    this.setProperty('selectable', selectable);\n  }\n\n  _renderSelectable() {\n    this.$container.toggleClass('selectable', !!this.selectable);\n    // Allow this field to receive the focus when selecting text with the mouse. Otherwise, form\n    // keystrokes would no longer work because the focus would automatically be set to the desktop\n    // for lack of alternatives. The value -1 ensures the field is skipped when tabbing through\n    // all form fields.\n    this.$field.toggleAttr('tabindex', !!this.selectable, '-1');\n  }\n\n  _onAppLinkAction(event) {\n    let $target = $(event.delegateTarget);\n    let ref = $target.data('ref');\n    this.triggerAppLinkAction(ref);\n  }\n\n  triggerAppLinkAction(ref) {\n    this.trigger('appLinkAction', {\n      ref: ref\n    });\n  }\n\n  _onImageLoad(event) {\n    this.invalidateLayoutTree();\n  }\n\n  _onImageError(event) {\n    this.invalidateLayoutTree();\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}