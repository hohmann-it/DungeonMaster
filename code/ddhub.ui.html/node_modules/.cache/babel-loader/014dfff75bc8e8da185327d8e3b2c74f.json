{"ast":null,"code":"/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { arrays, LookupCall, LookupRow, objects, QueryBy, RemoteLookupRequest, scout } from '../index';\nimport $ from 'jquery';\nexport default class RemoteLookupCall extends LookupCall {\n  constructor(adapter) {\n    super();\n    this.adapter = adapter;\n    this.deferred = null;\n  }\n\n  /**\n   * To be implemented by the subclass.\n   *\n   * @returns {Promise} which returns {LookupRow}s\n   */\n  _getAll() {\n    this._newDeferred(new RemoteLookupRequest(QueryBy.ALL));\n    this.adapter.sendLookup(QueryBy.ALL);\n    return this.deferred.promise();\n  }\n  _getByText(text) {\n    this._newDeferred(new RemoteLookupRequest(QueryBy.TEXT, text));\n    this.adapter.sendLookup(QueryBy.TEXT, text);\n    return this.deferred.promise();\n  }\n  _getByKey(key) {\n    this._newDeferred(new RemoteLookupRequest(QueryBy.KEY, key));\n    this.adapter.sendLookup(QueryBy.KEY, key);\n    return this.deferred.promise();\n  }\n  _getByRec(rec) {\n    this._newDeferred(new RemoteLookupRequest(QueryBy.REC, rec));\n    this.adapter.sendLookup(QueryBy.REC, rec);\n    return this.deferred.promise();\n  }\n  resolveLookup(lookupResult) {\n    if (!this._belongsToLatestRequest(lookupResult)) {\n      $.log.isTraceEnabled() && $.log.trace('(RemoteLookupCall#resolveLookup) ignore lookupResult. Does not belong to latest request', objects.optProperty(this.deferred, 'requestParameter'));\n      return;\n    }\n    let lookupRows = arrays.ensure(lookupResult.lookupRows).map(lookupRowObject => {\n      return scout.create('LookupRow', lookupRowObject);\n    });\n    lookupResult.lookupRows = lookupRows;\n    this.deferred.resolve(lookupResult);\n  }\n  _belongsToLatestRequest(lookupResult) {\n    // This case may happen when a lookup is initialized by the UI server (not the browser)\n    // Note: currently we simply ignore that case because it can only occur when the UI server\n    // calls doSearch in unexpected conditions. However, we could support this case in a similar\n    // way than we support requestInput().\n    if (!this.deferred) {\n      return false;\n    }\n    let propertyName = lookupResult.queryBy.toLowerCase(),\n      requestData = lookupResult[propertyName],\n      resultParameter = new RemoteLookupRequest(lookupResult.queryBy, requestData);\n    return this.deferred.requestParameter.equals(resultParameter);\n  }\n\n  /**\n   * Creates a new deferred and rejects the previous one.\n   */\n  _newDeferred(requestParameter) {\n    if (this.deferred) {\n      this.deferred.reject({\n        canceled: true\n      });\n    }\n    this.deferred = $.Deferred();\n    this.deferred.requestParameter = requestParameter;\n  }\n}","map":{"version":3,"names":["arrays","LookupCall","LookupRow","objects","QueryBy","RemoteLookupRequest","scout","$","RemoteLookupCall","constructor","adapter","deferred","_getAll","_newDeferred","ALL","sendLookup","promise","_getByText","text","TEXT","_getByKey","key","KEY","_getByRec","rec","REC","resolveLookup","lookupResult","_belongsToLatestRequest","log","isTraceEnabled","trace","optProperty","lookupRows","ensure","map","lookupRowObject","create","resolve","propertyName","queryBy","toLowerCase","requestData","resultParameter","requestParameter","equals","reject","canceled","Deferred"],"sources":["C:/git/d-d-hub/code/node_modules/.pnpm/@eclipse-scout+core@22.0.41/node_modules/@eclipse-scout/core/src/lookup/RemoteLookupCall.js"],"sourcesContent":["/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {arrays, LookupCall, LookupRow, objects, QueryBy, RemoteLookupRequest, scout} from '../index';\nimport $ from 'jquery';\n\nexport default class RemoteLookupCall extends LookupCall {\n\n  constructor(adapter) {\n    super();\n    this.adapter = adapter;\n    this.deferred = null;\n  }\n\n  /**\n   * To be implemented by the subclass.\n   *\n   * @returns {Promise} which returns {LookupRow}s\n   */\n  _getAll() {\n    this._newDeferred(new RemoteLookupRequest(QueryBy.ALL));\n    this.adapter.sendLookup(QueryBy.ALL);\n    return this.deferred.promise();\n  }\n\n  _getByText(text) {\n    this._newDeferred(new RemoteLookupRequest(QueryBy.TEXT, text));\n    this.adapter.sendLookup(QueryBy.TEXT, text);\n    return this.deferred.promise();\n  }\n\n  _getByKey(key) {\n    this._newDeferred(new RemoteLookupRequest(QueryBy.KEY, key));\n    this.adapter.sendLookup(QueryBy.KEY, key);\n    return this.deferred.promise();\n  }\n\n  _getByRec(rec) {\n    this._newDeferred(new RemoteLookupRequest(QueryBy.REC, rec));\n    this.adapter.sendLookup(QueryBy.REC, rec);\n    return this.deferred.promise();\n  }\n\n  resolveLookup(lookupResult) {\n    if (!this._belongsToLatestRequest(lookupResult)) {\n      $.log.isTraceEnabled() && $.log.trace('(RemoteLookupCall#resolveLookup) ignore lookupResult. Does not belong to latest request',\n        objects.optProperty(this.deferred, 'requestParameter'));\n      return;\n    }\n\n    let lookupRows = arrays.ensure(lookupResult.lookupRows).map(lookupRowObject => {\n      return scout.create('LookupRow', lookupRowObject);\n    });\n    lookupResult.lookupRows = lookupRows;\n    this.deferred.resolve(lookupResult);\n  }\n\n  _belongsToLatestRequest(lookupResult) {\n    // This case may happen when a lookup is initialized by the UI server (not the browser)\n    // Note: currently we simply ignore that case because it can only occur when the UI server\n    // calls doSearch in unexpected conditions. However, we could support this case in a similar\n    // way than we support requestInput().\n    if (!this.deferred) {\n      return false;\n    }\n\n    let propertyName = lookupResult.queryBy.toLowerCase(),\n      requestData = lookupResult[propertyName],\n      resultParameter = new RemoteLookupRequest(lookupResult.queryBy, requestData);\n    return this.deferred.requestParameter.equals(resultParameter);\n  }\n\n  /**\n   * Creates a new deferred and rejects the previous one.\n   */\n  _newDeferred(requestParameter) {\n    if (this.deferred) {\n      this.deferred.reject({\n        canceled: true\n      });\n    }\n    this.deferred = $.Deferred();\n    this.deferred.requestParameter = requestParameter;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}