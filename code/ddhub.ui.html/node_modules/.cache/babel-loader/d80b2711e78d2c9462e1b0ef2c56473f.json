{"ast":null,"code":"/*\n * Copyright (c) 2010-2019 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\n\n/**\n * The PromiseCreator is used to work with code that creates a lot of promises.\n * In some situations (e.g. file system access) only a few of the created promises can actually do work\n * all other promises must \"wait\" until, the browser finally excecutes the promise. All these promises\n * create some overhead. This class is used to prevent that, by delaying the creation of each promise\n * until the next() function is called. Typically the next function is not called until the previous\n * (one or more) promises have been executed.\n *\n * @constructor\n */\nexport default class PromiseCreator {\n  constructor(items) {\n    this.results = [];\n    this.error = null;\n    this.items = items;\n    this.currentItem = 0;\n    this.aborted = false;\n  }\n  hasNext() {\n    if (this.error || this.aborted) {\n      return false;\n    }\n    return this.currentItem < this.items.length;\n  }\n  next() {\n    var _this = this;\n    let thisItem = this.currentItem;\n    return this.createPromise().done(function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this._addResults.apply(_this, [thisItem, args]);\n    }).fail(function () {\n      // eslint-disable-next-line prefer-rest-params\n      this.error = arguments.length > 0 ? arguments : new Error('Promise execution failed');\n    }.bind(this));\n  }\n  createPromise() {\n    if (this.currentItem >= this.items.length) {\n      throw new Error('items out of bounds');\n    }\n    let promise = this._createPromise();\n    this.currentItem++;\n    return promise;\n  }\n  _createPromise() {\n    return this.items[this.currentItem]();\n  }\n  _addResults(index, result) {\n    if (result.length === 0) {\n      result = undefined;\n    } else if (result.length === 1) {\n      result = result[0];\n    }\n    this.results[index] = result;\n  }\n  abort() {\n    this.aborted = true;\n  }\n}","map":{"version":3,"names":["PromiseCreator","constructor","items","results","error","currentItem","aborted","hasNext","length","next","thisItem","createPromise","done","args","_addResults","apply","fail","arguments","Error","bind","promise","_createPromise","index","result","undefined","abort"],"sources":["C:/git/d-d-hub/code/node_modules/.pnpm/@eclipse-scout+core@22.0.41/node_modules/@eclipse-scout/core/src/util/PromiseCreator.js"],"sourcesContent":["/*\n * Copyright (c) 2010-2019 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\n\n/**\n * The PromiseCreator is used to work with code that creates a lot of promises.\n * In some situations (e.g. file system access) only a few of the created promises can actually do work\n * all other promises must \"wait\" until, the browser finally excecutes the promise. All these promises\n * create some overhead. This class is used to prevent that, by delaying the creation of each promise\n * until the next() function is called. Typically the next function is not called until the previous\n * (one or more) promises have been executed.\n *\n * @constructor\n */\nexport default class PromiseCreator {\n\n  constructor(items) {\n    this.results = [];\n    this.error = null;\n\n    this.items = items;\n    this.currentItem = 0;\n    this.aborted = false;\n  }\n\n  hasNext() {\n    if (this.error || this.aborted) {\n      return false;\n    }\n    return this.currentItem < this.items.length;\n  }\n\n  next() {\n    let thisItem = this.currentItem;\n    return this.createPromise()\n      .done((...args) => {\n        this._addResults.apply(this, [thisItem, args]);\n      })\n      .fail(function() {\n        // eslint-disable-next-line prefer-rest-params\n        this.error = arguments.length > 0 ? arguments : new Error('Promise execution failed');\n      }.bind(this));\n  }\n\n  createPromise() {\n    if (this.currentItem >= this.items.length) {\n      throw new Error('items out of bounds');\n    }\n\n    let promise = this._createPromise();\n    this.currentItem++;\n    return promise;\n  }\n\n  _createPromise() {\n    return this.items[this.currentItem]();\n  }\n\n  _addResults(index, result) {\n    if (result.length === 0) {\n      result = undefined;\n    } else if (result.length === 1) {\n      result = result[0];\n    }\n    this.results[index] = result;\n  }\n\n  abort() {\n    this.aborted = true;\n  }\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,MAAMA,cAAc,CAAC;EAElCC,WAAW,CAACC,KAAK,EAAE;IACjB,IAAI,CAACC,OAAO,GAAG,EAAE;IACjB,IAAI,CAACC,KAAK,GAAG,IAAI;IAEjB,IAAI,CAACF,KAAK,GAAGA,KAAK;IAClB,IAAI,CAACG,WAAW,GAAG,CAAC;IACpB,IAAI,CAACC,OAAO,GAAG,KAAK;EACtB;EAEAC,OAAO,GAAG;IACR,IAAI,IAAI,CAACH,KAAK,IAAI,IAAI,CAACE,OAAO,EAAE;MAC9B,OAAO,KAAK;IACd;IACA,OAAO,IAAI,CAACD,WAAW,GAAG,IAAI,CAACH,KAAK,CAACM,MAAM;EAC7C;EAEAC,IAAI,GAAG;IAAA;IACL,IAAIC,QAAQ,GAAG,IAAI,CAACL,WAAW;IAC/B,OAAO,IAAI,CAACM,aAAa,EAAE,CACxBC,IAAI,CAAC,YAAa;MAAA,kCAATC,IAAI;QAAJA,IAAI;MAAA;MACZ,KAAI,CAACC,WAAW,CAACC,KAAK,CAAC,KAAI,EAAE,CAACL,QAAQ,EAAEG,IAAI,CAAC,CAAC;IAChD,CAAC,CAAC,CACDG,IAAI,CAAC,YAAW;MACf;MACA,IAAI,CAACZ,KAAK,GAAGa,SAAS,CAACT,MAAM,GAAG,CAAC,GAAGS,SAAS,GAAG,IAAIC,KAAK,CAAC,0BAA0B,CAAC;IACvF,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC,CAAC;EACjB;EAEAR,aAAa,GAAG;IACd,IAAI,IAAI,CAACN,WAAW,IAAI,IAAI,CAACH,KAAK,CAACM,MAAM,EAAE;MACzC,MAAM,IAAIU,KAAK,CAAC,qBAAqB,CAAC;IACxC;IAEA,IAAIE,OAAO,GAAG,IAAI,CAACC,cAAc,EAAE;IACnC,IAAI,CAAChB,WAAW,EAAE;IAClB,OAAOe,OAAO;EAChB;EAEAC,cAAc,GAAG;IACf,OAAO,IAAI,CAACnB,KAAK,CAAC,IAAI,CAACG,WAAW,CAAC,EAAE;EACvC;EAEAS,WAAW,CAACQ,KAAK,EAAEC,MAAM,EAAE;IACzB,IAAIA,MAAM,CAACf,MAAM,KAAK,CAAC,EAAE;MACvBe,MAAM,GAAGC,SAAS;IACpB,CAAC,MAAM,IAAID,MAAM,CAACf,MAAM,KAAK,CAAC,EAAE;MAC9Be,MAAM,GAAGA,MAAM,CAAC,CAAC,CAAC;IACpB;IACA,IAAI,CAACpB,OAAO,CAACmB,KAAK,CAAC,GAAGC,MAAM;EAC9B;EAEAE,KAAK,GAAG;IACN,IAAI,CAACnB,OAAO,GAAG,IAAI;EACrB;AACF"},"metadata":{},"sourceType":"module"}