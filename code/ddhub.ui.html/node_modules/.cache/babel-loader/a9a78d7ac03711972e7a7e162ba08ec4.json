{"ast":null,"code":"/*\n * Copyright (c) 2010-2022 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * https://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\n\nimport { codes, Device, EventSupport, fonts, locales, logging, numbers, ObjectFactory, objects, scout, Session, texts, webstorage } from './index';\nimport $ from 'jquery';\nlet instance = null;\nlet listeners = [];\nexport default class App {\n  static addListener(type, func) {\n    let listener = {\n      type: type,\n      func: func\n    };\n    if (instance) {\n      instance.events.addListener(listener);\n    } else {\n      listeners.push(listener);\n    }\n    return listener;\n  }\n  static get() {\n    return instance;\n  }\n  constructor() {\n    this.events = this._createEventSupport();\n    this.initialized = false;\n    this.sessions = [];\n    this._loadingTimeoutId = null;\n\n    // register the listeners which were added to scout before the app is created\n    listeners.forEach(function (listener) {\n      this.addListener(listener);\n    }, this);\n    listeners = [];\n    instance = this;\n    this.errorHandler = this._createErrorHandler();\n  }\n\n  /**\n   * Main initialization function.<p>\n   *\n   * Calls this._prepare, this._bootstrap and this._init.<p>\n   * At the initial phase the essential objects are initialized, those which are required for the next phases like logging and the object factory.<br>\n   * During the bootstrap phase additional scripts may get loaded required for a successful session startup.<br>\n   * The actual initialization does not get started before these bootstrap scripts are loaded.\n   *\n   * @param {object} [options]\n   * @param {string|string[]} [options.bootstrap.textsUrl] URL or multiple URLs pointing to a json resource containing texts that will be available through texts.js.\n   * @param {string} [options.bootstrap.localesUrl] URL pointing to a json resource containing locale information processed by locales.js\n   * @param {string} [options.bootstrap.codesUrl] URL pointing to a json resources containing codes that will be available through codes.js\n   * @param {object} [options.session] Object to configure the session, see {@link Session.init} for the available options.\n   */\n  init(options) {\n    options = options || {};\n    return this._prepare(options).then(this._bootstrap.bind(this, options.bootstrap)).then(this._init.bind(this, options)).then(this._initDone.bind(this, options)).catch(this._fail.bind(this, options));\n  }\n\n  /**\n   * Initializes the logging framework and the object factory.\n   * This happens at the prepare phase because all these things should be available from the beginning.\n   */\n  _prepare(options) {\n    return this._prepareLogging(options).done(() => {\n      this._prepareEssentials(options);\n      this._prepareDone(options);\n    });\n  }\n  _prepareEssentials(options) {\n    ObjectFactory.get().init();\n  }\n  _prepareDone(options) {\n    this.trigger('prepare', {\n      options: options\n    });\n    $.log.isDebugEnabled() && $.log.debug('App prepared');\n  }\n  _prepareLogging(options) {\n    return logging.bootstrap();\n  }\n\n  /**\n   * Executes the default bootstrap functions and returns an array of promises.<p>\n   * The actual session startup begins only when every of these promises are completed.\n   * This gives the possibility to dynamically load additional scripts or files which are mandatory for a successful session startup.\n   * The individual bootstrap functions may return null or undefined, a single promise or multiple promises as an array.\n   */\n  _bootstrap(options) {\n    options = options || {};\n    let promises = [];\n    this._doBootstrap(options).forEach(value => {\n      if (Array.isArray(value)) {\n        promises.concat(value);\n      } else if (value) {\n        promises.push(value);\n      }\n    });\n    return $.promiseAll(promises).done(this._bootstrapDone.bind(this, options)).catch(this._bootstrapFail.bind(this, options));\n  }\n  _doBootstrap(options) {\n    return [Device.get().bootstrap(), fonts.bootstrap(options.fonts), locales.bootstrap(options.localesUrl), texts.bootstrap(options.textsUrl), codes.bootstrap(options.codesUrl)];\n  }\n  _bootstrapDone(options) {\n    webstorage.removeItemFromSessionStorage('scout:timeoutPageReload');\n    this.trigger('bootstrap', {\n      options: options\n    });\n    $.log.isDebugEnabled() && $.log.debug('App bootstrapped');\n  }\n  _bootstrapFail(options, vararg, textStatus, errorThrown, requestOptions) {\n    $.log.isInfoEnabled() && $.log.info('App bootstrap failed');\n\n    // If one of the bootstrap ajax call fails due to a session timeout, the index.html is probably loaded from cache without asking the server for its validity.\n    // Normally, loading the index.html should already return a session timeout, but if it is loaded from the (back button) cache, no request will be done and therefore no timeout can be returned.\n    // The browser is allowed to display a page when navigating back without issuing a request even though cache-headers are set to must-revalidate.\n    // The only way to prevent it would be the no-store header but then pressing back would always reload the page and not only on a session timeout.\n    // Sometimes the JavaScript and therefore the ajax calls won't be executed in case the page is loaded from that cache, but sometimes they will nevertheless (we don't know the reasons).\n    // So, if it that happens, the server will return a session timeout and the best thing we can do is to reload the page hoping a request for the index.html will be done which eventually will be forwarded to the login page.\n    if ($.isJqXHR(vararg)) {\n      // Ajax error\n      // If a resource returns 401 (unauthorized) it is likely a session timeout.\n      // This may happen if no Scout backend is used or a reverse proxy returned the response, otherwise status 200 with an error object would be returned, see below\n      if (this._isSessionTimeoutStatus(vararg.status)) {\n        let url = requestOptions ? requestOptions.url : '';\n        this._handleBootstrapTimeoutError(vararg, url);\n        return;\n      }\n    } else if (objects.isPlainObject(vararg) && vararg.error) {\n      // Json based error\n      // Json errors (normally processed by Session.js) are returned with http status 200\n      if (vararg.error.code === Session.JsonResponseError.SESSION_TIMEOUT) {\n        this._handleBootstrapTimeoutError(vararg.error, vararg.url);\n        return;\n      }\n    }\n\n    // Make sure promise will be rejected with all original arguments so that it can be eventually handled by this._fail\n    // eslint-disable-next-line prefer-rest-params\n    let args = objects.argumentsToArray(arguments).slice(1);\n    return $.rejectedPromise(...args);\n  }\n  _isSessionTimeoutStatus(httpStatus) {\n    return httpStatus === 401;\n  }\n  _handleBootstrapTimeoutError(error, url) {\n    $.log.isInfoEnabled() && $.log.info('Timeout error for resource ' + url + '. Reloading page...');\n    if (webstorage.getItemFromSessionStorage('scout:timeoutPageReload')) {\n      // Prevent loop in case a reload did not solve the problem\n      $.log.isWarnEnabled() && $.log.warn('Prevented automatic reload, startup will likely fail', error, url);\n      webstorage.removeItemFromSessionStorage('scout:timeoutPageReload');\n      throw new Error('Resource ' + url + ' could not be loaded due to a session timeout, even after a page reload');\n    }\n    webstorage.setItemToSessionStorage('scout:timeoutPageReload', true);\n\n    // See comment in _bootstrapFail for the reasons why to reload here\n    scout.reloadPage();\n  }\n\n  /**\n   * Initializes a session for each html element with class '.scout' and stores them in scout.sessions.\n   */\n  _init(options) {\n    options = options || {};\n    this.setLoading(true);\n    let compatibilityPromise = this._checkBrowserCompatibility(options);\n    if (compatibilityPromise) {\n      this.setLoading(false);\n      return compatibilityPromise.then(newOptions => this._init(newOptions));\n    }\n    this._initVersion(options);\n    this._prepareDOM();\n    this._installErrorHandler();\n    this._installGlobalMouseDownInterceptor();\n    this._installSyntheticActiveStateHandler();\n    this._ajaxSetup();\n    this._installExtensions();\n    return this._load(options).then(this._loadSessions.bind(this, options.session));\n  }\n\n  /**\n   * Maybe implemented to load data from a server before the desktop is created.\n   * @returns {Promise} promise which is resolved after the loading is complete\n   */\n  _load(options) {\n    return $.resolvedPromise();\n  }\n  _checkBrowserCompatibility(options) {\n    let device = Device.get();\n    $.log.isInfoEnabled() && $.log.info('Detected browser ' + device.browser + ' version ' + device.browserVersion);\n    if (!scout.nvl(options.checkBrowserCompatibility, true) || device.isSupportedBrowser()) {\n      // No check requested or browser is supported\n      return;\n    }\n    let deferred = $.Deferred();\n    let newOptions = objects.valueCopy(options);\n    newOptions.checkBrowserCompatibility = false;\n    $('.scout').each(function () {\n      let $entryPoint = $(this);\n      let $box = $entryPoint.appendDiv();\n      $box.load('unsupported-browser.html', () => {\n        $box.find('button').on('click', () => {\n          $box.remove();\n          deferred.resolve(newOptions);\n        });\n      });\n    });\n    return deferred.promise();\n  }\n  setLoading(loading) {\n    if (loading) {\n      this._loadingTimeoutId = setTimeout(() => {\n        // Don't start loading if a desktop is already rendered to prevent flickering when the loading will be set to false after app initialization finishes\n        if (!this.sessions.some(session => session.desktop && session.desktop.rendered)) {\n          this._renderLoading();\n        }\n      }, 200);\n    } else {\n      clearTimeout(this._loadingTimeoutId);\n      this._loadingTimeoutId = null;\n      this._removeLoading();\n    }\n  }\n  _renderLoading() {\n    let $body = $('body'),\n      $loadingRoot = $body.children('.application-loading-root');\n    if (!$loadingRoot.length) {\n      $loadingRoot = $body.appendDiv('application-loading-root').addClass('application-loading-root').fadeIn();\n    }\n    this._renderLoadingElement($loadingRoot, 'application-loading01');\n    this._renderLoadingElement($loadingRoot, 'application-loading02');\n    this._renderLoadingElement($loadingRoot, 'application-loading03');\n  }\n  _renderLoadingElement($loadingRoot, cssClass) {\n    if ($loadingRoot.children('.' + cssClass).length) {\n      return;\n    }\n    // noinspection JSValidateTypes\n    $loadingRoot.appendDiv(cssClass).hide().fadeIn();\n  }\n  _removeLoading() {\n    let $loadingRoot = $('body').children('.application-loading-root');\n    // the fadeout animation only contains a to-value and no from-value\n    // therefore set the current value to the elements style\n    $loadingRoot.css('opacity', $loadingRoot.css('opacity'));\n    // Add animation listener before adding the classes to ensure the listener will always be triggered even while debugging\n    $loadingRoot.oneAnimationEnd(() => $loadingRoot.remove());\n    if ($loadingRoot.css('opacity') === '1') {\n      $loadingRoot.addClass('fadeout and-more');\n    } else {\n      $loadingRoot.addClass('fadeout');\n    }\n    if (!Device.get().supportsCssAnimation()) {\n      // fallback for old browsers that do not support the animation-end event\n      $loadingRoot.remove();\n    }\n  }\n  _initVersion(options) {\n    this.version = scout.nvl(this.version, options.version, $('scout-version').data('value'));\n  }\n  _prepareDOM() {\n    scout.prepareDOM(document);\n  }\n  _installGlobalMouseDownInterceptor() {\n    scout.installGlobalMouseDownInterceptor(document);\n  }\n  _installSyntheticActiveStateHandler() {\n    scout.installSyntheticActiveStateHandler(document);\n  }\n\n  /**\n   * Installs a global error handler.\n   * <p>\n   * Note: we do not install an error handler on popup-windows because everything is controlled by the main-window\n   * so exceptions will also occur in that window. This also means, the fatal message-box will be displayed in the\n   * main-window, even when a popup-window is opened and active.\n   * <p>\n   * Caution: The error.stack doesn't look the same in different browsers. Chrome for instance puts the error message\n   * on the first line of the stack. Firefox does only contain the stack lines, without the message, but in return\n   * the stack trace is much longer :)\n   */\n  _installErrorHandler() {\n    window.onerror = this.errorHandler.windowErrorHandler;\n    // FIXME bsh, cgu: use ErrorHandler to handle unhandled promise rejections. Just replacing jQuery.Deferred.exceptionHook(error, stack) does not work\n    // because it is called on every exception and not only on unhandled.\n    // https://developer.mozilla.org/en-US/docs/Web/API/Window/unhandledrejection_event would be exactly what we need, but jQuery does not support it.\n    // Bluebird has a polyfill -> can it be ported to jQuery?\n  }\n\n  _createErrorHandler(opts) {\n    opts = $.extend({}, opts);\n    return scout.create('ErrorHandler', opts);\n  }\n\n  /**\n   * Uses the object returned by {@link #_ajaxDefaults} to setup ajax. The values in that object are used as default values for every ajax call.\n   */\n  _ajaxSetup() {\n    let ajaxDefaults = this._ajaxDefaults();\n    if (ajaxDefaults) {\n      $.ajaxSetup(ajaxDefaults);\n    }\n  }\n\n  /**\n   * Returns the defaults for every ajax call. You may override it to set custom defaults.\n   * By default _beforeAjaxCall is assigned to the beforeSend method.\n   * <p>\n   * Note: This will affect every ajax call, so use it with care! See also the advice on https://api.jquery.com/jquery.ajaxsetup/.\n   */\n  _ajaxDefaults() {\n    return {\n      beforeSend: this._beforeAjaxCall.bind(this)\n    };\n  }\n\n  /**\n   * Called before every ajax call. Sets the header X-Scout-Correlation-Id.\n   * <p>\n   * Maybe overridden to set custom headers or to execute other code which should run before an ajax call.\n   */\n  _beforeAjaxCall(request) {\n    request.setRequestHeader('X-Scout-Correlation-Id', numbers.correlationId());\n    request.setRequestHeader('X-Requested-With', 'XMLHttpRequest'); // explicitly add here because jQuery only adds it automatically if it is no crossDomain request\n  }\n\n  _loadSessions(options) {\n    options = options || {};\n    let promises = [];\n    $('.scout').each((i, elem) => {\n      let $entryPoint = $(elem);\n      options.portletPartId = options.portletPartId || $entryPoint.data('partid') || '0';\n      let promise = this._loadSession($entryPoint, options);\n      promises.push(promise);\n    });\n    return $.promiseAll(promises);\n  }\n\n  /**\n   * @returns {Promise} promise which is resolved when the session is ready\n   */\n  _loadSession($entryPoint, options) {\n    options.locale = options.locale || this._loadLocale();\n    options.$entryPoint = $entryPoint;\n    let session = this._createSession(options);\n    this.sessions.push(session);\n\n    // TODO [7.0] cgu improve this, start must not be executed because it currently does a server request\n    let desktop = this._createDesktop(session.root);\n    this._triggerDesktopReady(desktop);\n    session.render(() => {\n      session._renderDesktop();\n\n      // Ensure layout is valid (explicitly layout immediately and don't wait for setTimeout to run to make layouting invisible to the user)\n      session.layoutValidator.validate();\n      session.focusManager.validateFocus();\n      session.ready = true;\n      this._triggerSessionReady(session);\n      $.log.isInfoEnabled() && $.log.info('Session initialized. Detected ' + Device.get());\n    });\n    return $.resolvedPromise();\n  }\n  _triggerDesktopReady(desktop) {\n    this.trigger('desktopReady', {\n      desktop: desktop\n    });\n  }\n  _triggerSessionReady(session) {\n    this.trigger('sessionReady', {\n      session: session\n    });\n  }\n  _createSession(options) {\n    return scout.create('Session', options, {\n      ensureUniqueId: false\n    });\n  }\n  _createDesktop(parent) {\n    return scout.create('Desktop', {\n      parent: parent\n    });\n  }\n\n  /**\n   * @returns {Locale} the locale to be used when no locale is provided as app option. By default the navigators locale is used.\n   */\n  _loadLocale() {\n    return locales.getNavigatorLocale();\n  }\n  _initDone(options) {\n    this.initialized = true;\n    this.setLoading(false);\n    this.trigger('init', {\n      options: options\n    });\n    $.log.isInfoEnabled() && $.log.info('App initialized');\n  }\n  _fail(options, error) {\n    for (var _len = arguments.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n      args[_key - 2] = arguments[_key];\n    }\n    $.log.error('App initialization failed.');\n    this.setLoading(false);\n    let promises = [];\n    if (this.sessions.length === 0) {\n      promises.push(this.errorHandler.handle(error, ...args).then(errorInfo => {\n        this._appendStartupError($('body'), errorInfo.message);\n      }));\n    } else {\n      // Session.js may already display a fatal message box\n      // -> don't handle the error again and display multiple error messages\n      this.sessions.filter(session => !session.ready && !session.isFatalMessageShown()).forEach(session => {\n        session.$entryPoint.empty();\n        promises.push(this._createErrorHandler({\n          session: session\n        }).handle(error));\n      });\n    }\n\n    // Reject with original rejection arguments\n    return $.promiseAll(promises).then(errorInfo => $.rejectedPromise(error, ...args));\n  }\n  _appendStartupError($parent, message) {\n    let $error = $parent.appendDiv('startup-error');\n    $error.appendDiv('startup-error-title').text('The application could not be started');\n    if (message) {\n      $error.appendDiv('startup-error-message').text(message);\n    }\n  }\n\n  /**\n   * Override this method to install extensions to Scout objects. Since the extension feature replaces functions\n   * on the prototype of the Scout objects you must apply 'function patches' to Scout framework or other code before\n   * the extensions are installed.\n   *\n   * The default implementation does nothing.\n   */\n  _installExtensions() {\n    // NOP\n  }\n\n  // --- Event handling methods ---\n  _createEventSupport() {\n    return new EventSupport();\n  }\n  trigger(type, event) {\n    event = event || {};\n    event.source = this;\n    this.events.trigger(type, event);\n  }\n  one(type, func) {\n    this.events.one(type, func);\n  }\n  on(type, func) {\n    return this.events.on(type, func);\n  }\n  off(type, func) {\n    this.events.off(type, func);\n  }\n  addListener(listener) {\n    this.events.addListener(listener);\n  }\n  removeListener(listener) {\n    this.events.removeListener(listener);\n  }\n  when(type) {\n    return this.events.when(type);\n  }\n}","map":{"version":3,"names":["codes","Device","EventSupport","fonts","locales","logging","numbers","ObjectFactory","objects","scout","Session","texts","webstorage","$","instance","listeners","App","addListener","type","func","listener","events","push","get","constructor","_createEventSupport","initialized","sessions","_loadingTimeoutId","forEach","errorHandler","_createErrorHandler","init","options","_prepare","then","_bootstrap","bind","bootstrap","_init","_initDone","catch","_fail","_prepareLogging","done","_prepareEssentials","_prepareDone","trigger","log","isDebugEnabled","debug","promises","_doBootstrap","value","Array","isArray","concat","promiseAll","_bootstrapDone","_bootstrapFail","localesUrl","textsUrl","codesUrl","removeItemFromSessionStorage","vararg","textStatus","errorThrown","requestOptions","isInfoEnabled","info","isJqXHR","_isSessionTimeoutStatus","status","url","_handleBootstrapTimeoutError","isPlainObject","error","code","JsonResponseError","SESSION_TIMEOUT","args","argumentsToArray","arguments","slice","rejectedPromise","httpStatus","getItemFromSessionStorage","isWarnEnabled","warn","Error","setItemToSessionStorage","reloadPage","setLoading","compatibilityPromise","_checkBrowserCompatibility","newOptions","_initVersion","_prepareDOM","_installErrorHandler","_installGlobalMouseDownInterceptor","_installSyntheticActiveStateHandler","_ajaxSetup","_installExtensions","_load","_loadSessions","session","resolvedPromise","device","browser","browserVersion","nvl","checkBrowserCompatibility","isSupportedBrowser","deferred","Deferred","valueCopy","each","$entryPoint","$box","appendDiv","load","find","on","remove","resolve","promise","loading","setTimeout","some","desktop","rendered","_renderLoading","clearTimeout","_removeLoading","$body","$loadingRoot","children","length","addClass","fadeIn","_renderLoadingElement","cssClass","hide","css","oneAnimationEnd","supportsCssAnimation","version","data","prepareDOM","document","installGlobalMouseDownInterceptor","installSyntheticActiveStateHandler","window","onerror","windowErrorHandler","opts","extend","create","ajaxDefaults","_ajaxDefaults","ajaxSetup","beforeSend","_beforeAjaxCall","request","setRequestHeader","correlationId","i","elem","portletPartId","_loadSession","locale","_loadLocale","_createSession","_createDesktop","root","_triggerDesktopReady","render","_renderDesktop","layoutValidator","validate","focusManager","validateFocus","ready","_triggerSessionReady","ensureUniqueId","parent","getNavigatorLocale","handle","errorInfo","_appendStartupError","message","filter","isFatalMessageShown","empty","$parent","$error","text","event","source","one","off","removeListener","when"],"sources":["C:/git/d-d-hub/code/node_modules/.pnpm/@eclipse-scout+core@22.0.41/node_modules/@eclipse-scout/core/src/App.js"],"sourcesContent":["/*\n * Copyright (c) 2010-2022 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * https://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\n\nimport {codes, Device, EventSupport, fonts, locales, logging, numbers, ObjectFactory, objects, scout, Session, texts, webstorage} from './index';\nimport $ from 'jquery';\n\nlet instance = null;\nlet listeners = [];\n\nexport default class App {\n\n  static addListener(type, func) {\n    let listener = {\n      type: type,\n      func: func\n    };\n    if (instance) {\n      instance.events.addListener(listener);\n    } else {\n      listeners.push(listener);\n    }\n    return listener;\n  }\n\n  static get() {\n    return instance;\n  }\n\n  constructor() {\n    this.events = this._createEventSupport();\n    this.initialized = false;\n    this.sessions = [];\n    this._loadingTimeoutId = null;\n\n    // register the listeners which were added to scout before the app is created\n    listeners.forEach(function(listener) {\n      this.addListener(listener);\n    }, this);\n    listeners = [];\n\n    instance = this;\n    this.errorHandler = this._createErrorHandler();\n  }\n\n  /**\n   * Main initialization function.<p>\n   *\n   * Calls this._prepare, this._bootstrap and this._init.<p>\n   * At the initial phase the essential objects are initialized, those which are required for the next phases like logging and the object factory.<br>\n   * During the bootstrap phase additional scripts may get loaded required for a successful session startup.<br>\n   * The actual initialization does not get started before these bootstrap scripts are loaded.\n   *\n   * @param {object} [options]\n   * @param {string|string[]} [options.bootstrap.textsUrl] URL or multiple URLs pointing to a json resource containing texts that will be available through texts.js.\n   * @param {string} [options.bootstrap.localesUrl] URL pointing to a json resource containing locale information processed by locales.js\n   * @param {string} [options.bootstrap.codesUrl] URL pointing to a json resources containing codes that will be available through codes.js\n   * @param {object} [options.session] Object to configure the session, see {@link Session.init} for the available options.\n   */\n  init(options) {\n    options = options || {};\n    return this._prepare(options)\n      .then(this._bootstrap.bind(this, options.bootstrap))\n      .then(this._init.bind(this, options))\n      .then(this._initDone.bind(this, options))\n      .catch(this._fail.bind(this, options));\n  }\n\n  /**\n   * Initializes the logging framework and the object factory.\n   * This happens at the prepare phase because all these things should be available from the beginning.\n   */\n  _prepare(options) {\n    return this._prepareLogging(options)\n      .done(() => {\n        this._prepareEssentials(options);\n        this._prepareDone(options);\n      });\n  }\n\n  _prepareEssentials(options) {\n    ObjectFactory.get().init();\n  }\n\n  _prepareDone(options) {\n    this.trigger('prepare', {\n      options: options\n    });\n    $.log.isDebugEnabled() && $.log.debug('App prepared');\n  }\n\n  _prepareLogging(options) {\n    return logging.bootstrap();\n  }\n\n  /**\n   * Executes the default bootstrap functions and returns an array of promises.<p>\n   * The actual session startup begins only when every of these promises are completed.\n   * This gives the possibility to dynamically load additional scripts or files which are mandatory for a successful session startup.\n   * The individual bootstrap functions may return null or undefined, a single promise or multiple promises as an array.\n   */\n  _bootstrap(options) {\n    options = options || {};\n\n    let promises = [];\n    this._doBootstrap(options).forEach(value => {\n      if (Array.isArray(value)) {\n        promises.concat(value);\n      } else if (value) {\n        promises.push(value);\n      }\n    });\n\n    return $.promiseAll(promises)\n      .done(this._bootstrapDone.bind(this, options))\n      .catch(this._bootstrapFail.bind(this, options));\n  }\n\n  _doBootstrap(options) {\n    return [\n      Device.get().bootstrap(),\n      fonts.bootstrap(options.fonts),\n      locales.bootstrap(options.localesUrl),\n      texts.bootstrap(options.textsUrl),\n      codes.bootstrap(options.codesUrl)\n    ];\n  }\n\n  _bootstrapDone(options) {\n    webstorage.removeItemFromSessionStorage('scout:timeoutPageReload');\n    this.trigger('bootstrap', {\n      options: options\n    });\n    $.log.isDebugEnabled() && $.log.debug('App bootstrapped');\n  }\n\n  _bootstrapFail(options, vararg, textStatus, errorThrown, requestOptions) {\n    $.log.isInfoEnabled() && $.log.info('App bootstrap failed');\n\n    // If one of the bootstrap ajax call fails due to a session timeout, the index.html is probably loaded from cache without asking the server for its validity.\n    // Normally, loading the index.html should already return a session timeout, but if it is loaded from the (back button) cache, no request will be done and therefore no timeout can be returned.\n    // The browser is allowed to display a page when navigating back without issuing a request even though cache-headers are set to must-revalidate.\n    // The only way to prevent it would be the no-store header but then pressing back would always reload the page and not only on a session timeout.\n    // Sometimes the JavaScript and therefore the ajax calls won't be executed in case the page is loaded from that cache, but sometimes they will nevertheless (we don't know the reasons).\n    // So, if it that happens, the server will return a session timeout and the best thing we can do is to reload the page hoping a request for the index.html will be done which eventually will be forwarded to the login page.\n    if ($.isJqXHR(vararg)) {\n      // Ajax error\n      // If a resource returns 401 (unauthorized) it is likely a session timeout.\n      // This may happen if no Scout backend is used or a reverse proxy returned the response, otherwise status 200 with an error object would be returned, see below\n      if (this._isSessionTimeoutStatus(vararg.status)) {\n        let url = requestOptions ? requestOptions.url : '';\n        this._handleBootstrapTimeoutError(vararg, url);\n        return;\n      }\n    } else if (objects.isPlainObject(vararg) && vararg.error) {\n      // Json based error\n      // Json errors (normally processed by Session.js) are returned with http status 200\n      if (vararg.error.code === Session.JsonResponseError.SESSION_TIMEOUT) {\n        this._handleBootstrapTimeoutError(vararg.error, vararg.url);\n        return;\n      }\n    }\n\n    // Make sure promise will be rejected with all original arguments so that it can be eventually handled by this._fail\n    // eslint-disable-next-line prefer-rest-params\n    let args = objects.argumentsToArray(arguments).slice(1);\n    return $.rejectedPromise(...args);\n  }\n\n  _isSessionTimeoutStatus(httpStatus) {\n    return httpStatus === 401;\n  }\n\n  _handleBootstrapTimeoutError(error, url) {\n    $.log.isInfoEnabled() && $.log.info('Timeout error for resource ' + url + '. Reloading page...');\n    if (webstorage.getItemFromSessionStorage('scout:timeoutPageReload')) {\n      // Prevent loop in case a reload did not solve the problem\n      $.log.isWarnEnabled() && $.log.warn('Prevented automatic reload, startup will likely fail', error, url);\n      webstorage.removeItemFromSessionStorage('scout:timeoutPageReload');\n      throw new Error('Resource ' + url + ' could not be loaded due to a session timeout, even after a page reload');\n    }\n    webstorage.setItemToSessionStorage('scout:timeoutPageReload', true);\n\n    // See comment in _bootstrapFail for the reasons why to reload here\n    scout.reloadPage();\n  }\n\n  /**\n   * Initializes a session for each html element with class '.scout' and stores them in scout.sessions.\n   */\n  _init(options) {\n    options = options || {};\n    this.setLoading(true);\n    let compatibilityPromise = this._checkBrowserCompatibility(options);\n    if (compatibilityPromise) {\n      this.setLoading(false);\n      return compatibilityPromise.then(newOptions => this._init(newOptions));\n    }\n\n    this._initVersion(options);\n    this._prepareDOM();\n    this._installErrorHandler();\n    this._installGlobalMouseDownInterceptor();\n    this._installSyntheticActiveStateHandler();\n    this._ajaxSetup();\n    this._installExtensions();\n    return this._load(options)\n      .then(this._loadSessions.bind(this, options.session));\n  }\n\n  /**\n   * Maybe implemented to load data from a server before the desktop is created.\n   * @returns {Promise} promise which is resolved after the loading is complete\n   */\n  _load(options) {\n    return $.resolvedPromise();\n  }\n\n  _checkBrowserCompatibility(options) {\n    let device = Device.get();\n    $.log.isInfoEnabled() && $.log.info('Detected browser ' + device.browser + ' version ' + device.browserVersion);\n    if (!scout.nvl(options.checkBrowserCompatibility, true) || device.isSupportedBrowser()) {\n      // No check requested or browser is supported\n      return;\n    }\n\n    let deferred = $.Deferred();\n    let newOptions = objects.valueCopy(options);\n    newOptions.checkBrowserCompatibility = false;\n    $('.scout').each(function() {\n      let $entryPoint = $(this);\n      let $box = $entryPoint.appendDiv();\n\n      $box.load('unsupported-browser.html', () => {\n        $box.find('button').on('click', () => {\n          $box.remove();\n          deferred.resolve(newOptions);\n        });\n      });\n    });\n    return deferred.promise();\n  }\n\n  setLoading(loading) {\n    if (loading) {\n      this._loadingTimeoutId = setTimeout(() => {\n        // Don't start loading if a desktop is already rendered to prevent flickering when the loading will be set to false after app initialization finishes\n        if (!this.sessions.some(session => session.desktop && session.desktop.rendered)) {\n          this._renderLoading();\n        }\n      }, 200);\n    } else {\n      clearTimeout(this._loadingTimeoutId);\n      this._loadingTimeoutId = null;\n      this._removeLoading();\n    }\n  }\n\n  _renderLoading() {\n    let $body = $('body'),\n      $loadingRoot = $body.children('.application-loading-root');\n    if (!$loadingRoot.length) {\n      $loadingRoot = $body.appendDiv('application-loading-root')\n        .addClass('application-loading-root')\n        .fadeIn();\n    }\n    this._renderLoadingElement($loadingRoot, 'application-loading01');\n    this._renderLoadingElement($loadingRoot, 'application-loading02');\n    this._renderLoadingElement($loadingRoot, 'application-loading03');\n  }\n\n  _renderLoadingElement($loadingRoot, cssClass) {\n    if ($loadingRoot.children('.' + cssClass).length) {\n      return;\n    }\n    // noinspection JSValidateTypes\n    $loadingRoot.appendDiv(cssClass).hide()\n      .fadeIn();\n  }\n\n  _removeLoading() {\n    let $loadingRoot = $('body').children('.application-loading-root');\n    // the fadeout animation only contains a to-value and no from-value\n    // therefore set the current value to the elements style\n    $loadingRoot.css('opacity', $loadingRoot.css('opacity'));\n    // Add animation listener before adding the classes to ensure the listener will always be triggered even while debugging\n    $loadingRoot.oneAnimationEnd(() => $loadingRoot.remove());\n    if ($loadingRoot.css('opacity') === '1') {\n      $loadingRoot.addClass('fadeout and-more');\n    } else {\n      $loadingRoot.addClass('fadeout');\n    }\n    if (!Device.get().supportsCssAnimation()) {\n      // fallback for old browsers that do not support the animation-end event\n      $loadingRoot.remove();\n    }\n  }\n\n  _initVersion(options) {\n    this.version = scout.nvl(\n      this.version,\n      options.version,\n      $('scout-version').data('value'));\n  }\n\n  _prepareDOM() {\n    scout.prepareDOM(document);\n  }\n\n  _installGlobalMouseDownInterceptor() {\n    scout.installGlobalMouseDownInterceptor(document);\n  }\n\n  _installSyntheticActiveStateHandler() {\n    scout.installSyntheticActiveStateHandler(document);\n  }\n\n  /**\n   * Installs a global error handler.\n   * <p>\n   * Note: we do not install an error handler on popup-windows because everything is controlled by the main-window\n   * so exceptions will also occur in that window. This also means, the fatal message-box will be displayed in the\n   * main-window, even when a popup-window is opened and active.\n   * <p>\n   * Caution: The error.stack doesn't look the same in different browsers. Chrome for instance puts the error message\n   * on the first line of the stack. Firefox does only contain the stack lines, without the message, but in return\n   * the stack trace is much longer :)\n   */\n  _installErrorHandler() {\n    window.onerror = this.errorHandler.windowErrorHandler;\n    // FIXME bsh, cgu: use ErrorHandler to handle unhandled promise rejections. Just replacing jQuery.Deferred.exceptionHook(error, stack) does not work\n    // because it is called on every exception and not only on unhandled.\n    // https://developer.mozilla.org/en-US/docs/Web/API/Window/unhandledrejection_event would be exactly what we need, but jQuery does not support it.\n    // Bluebird has a polyfill -> can it be ported to jQuery?\n  }\n\n  _createErrorHandler(opts) {\n    opts = $.extend({}, opts);\n    return scout.create('ErrorHandler', opts);\n  }\n\n  /**\n   * Uses the object returned by {@link #_ajaxDefaults} to setup ajax. The values in that object are used as default values for every ajax call.\n   */\n  _ajaxSetup() {\n    let ajaxDefaults = this._ajaxDefaults();\n    if (ajaxDefaults) {\n      $.ajaxSetup(ajaxDefaults);\n    }\n  }\n\n  /**\n   * Returns the defaults for every ajax call. You may override it to set custom defaults.\n   * By default _beforeAjaxCall is assigned to the beforeSend method.\n   * <p>\n   * Note: This will affect every ajax call, so use it with care! See also the advice on https://api.jquery.com/jquery.ajaxsetup/.\n   */\n  _ajaxDefaults() {\n    return {\n      beforeSend: this._beforeAjaxCall.bind(this)\n    };\n  }\n\n  /**\n   * Called before every ajax call. Sets the header X-Scout-Correlation-Id.\n   * <p>\n   * Maybe overridden to set custom headers or to execute other code which should run before an ajax call.\n   */\n  _beforeAjaxCall(request) {\n    request.setRequestHeader('X-Scout-Correlation-Id', numbers.correlationId());\n    request.setRequestHeader('X-Requested-With', 'XMLHttpRequest'); // explicitly add here because jQuery only adds it automatically if it is no crossDomain request\n  }\n\n  _loadSessions(options) {\n    options = options || {};\n    let promises = [];\n    $('.scout').each((i, elem) => {\n      let $entryPoint = $(elem);\n      options.portletPartId = options.portletPartId || $entryPoint.data('partid') || '0';\n      let promise = this._loadSession($entryPoint, options);\n      promises.push(promise);\n    });\n    return $.promiseAll(promises);\n  }\n\n  /**\n   * @returns {Promise} promise which is resolved when the session is ready\n   */\n  _loadSession($entryPoint, options) {\n    options.locale = options.locale || this._loadLocale();\n    options.$entryPoint = $entryPoint;\n    let session = this._createSession(options);\n    this.sessions.push(session);\n\n    // TODO [7.0] cgu improve this, start must not be executed because it currently does a server request\n    let desktop = this._createDesktop(session.root);\n    this._triggerDesktopReady(desktop);\n    session.render(() => {\n      session._renderDesktop();\n\n      // Ensure layout is valid (explicitly layout immediately and don't wait for setTimeout to run to make layouting invisible to the user)\n      session.layoutValidator.validate();\n      session.focusManager.validateFocus();\n\n      session.ready = true;\n      this._triggerSessionReady(session);\n      $.log.isInfoEnabled() && $.log.info('Session initialized. Detected ' + Device.get());\n    });\n    return $.resolvedPromise();\n  }\n\n  _triggerDesktopReady(desktop) {\n    this.trigger('desktopReady', {\n      desktop: desktop\n    });\n  }\n\n  _triggerSessionReady(session) {\n    this.trigger('sessionReady', {\n      session: session\n    });\n  }\n\n  _createSession(options) {\n    return scout.create('Session', options, {\n      ensureUniqueId: false\n    });\n  }\n\n  _createDesktop(parent) {\n    return scout.create('Desktop', {\n      parent: parent\n    });\n  }\n\n  /**\n   * @returns {Locale} the locale to be used when no locale is provided as app option. By default the navigators locale is used.\n   */\n  _loadLocale() {\n    return locales.getNavigatorLocale();\n  }\n\n  _initDone(options) {\n    this.initialized = true;\n    this.setLoading(false);\n    this.trigger('init', {\n      options: options\n    });\n    $.log.isInfoEnabled() && $.log.info('App initialized');\n  }\n\n  _fail(options, error, ...args) {\n    $.log.error('App initialization failed.');\n    this.setLoading(false);\n\n    let promises = [];\n    if (this.sessions.length === 0) {\n      promises.push(this.errorHandler.handle(error, ...args)\n        .then(errorInfo => {\n          this._appendStartupError($('body'), errorInfo.message);\n        }));\n    } else {\n      // Session.js may already display a fatal message box\n      // -> don't handle the error again and display multiple error messages\n      this.sessions\n        .filter(session => !session.ready && !session.isFatalMessageShown())\n        .forEach(session => {\n          session.$entryPoint.empty();\n          promises.push(this._createErrorHandler({session: session}).handle(error));\n        });\n    }\n\n    // Reject with original rejection arguments\n    return $.promiseAll(promises).then(errorInfo => $.rejectedPromise(error, ...args));\n  }\n\n  _appendStartupError($parent, message) {\n    let $error = $parent.appendDiv('startup-error');\n    $error.appendDiv('startup-error-title').text('The application could not be started');\n    if (message) {\n      $error.appendDiv('startup-error-message').text(message);\n    }\n  }\n\n  /**\n   * Override this method to install extensions to Scout objects. Since the extension feature replaces functions\n   * on the prototype of the Scout objects you must apply 'function patches' to Scout framework or other code before\n   * the extensions are installed.\n   *\n   * The default implementation does nothing.\n   */\n  _installExtensions() {\n    // NOP\n  }\n\n  // --- Event handling methods ---\n  _createEventSupport() {\n    return new EventSupport();\n  }\n\n  trigger(type, event) {\n    event = event || {};\n    event.source = this;\n    this.events.trigger(type, event);\n  }\n\n  one(type, func) {\n    this.events.one(type, func);\n  }\n\n  on(type, func) {\n    return this.events.on(type, func);\n  }\n\n  off(type, func) {\n    this.events.off(type, func);\n  }\n\n  addListener(listener) {\n    this.events.addListener(listener);\n  }\n\n  removeListener(listener) {\n    this.events.removeListener(listener);\n  }\n\n  when(type) {\n    return this.events.when(type);\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}