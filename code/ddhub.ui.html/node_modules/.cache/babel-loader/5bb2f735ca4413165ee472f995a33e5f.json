{"ast":null,"code":"/*\n * Copyright (c) 2010-2021 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { InputFieldKeyStrokeContext, keys, keyStrokeModifier, Outline, scout, SearchOutlineLayout } from '../../index';\nimport $ from 'jquery';\nexport default class SearchOutline extends Outline {\n  constructor() {\n    super();\n    this.hasText = false;\n    this.$searchPanel = null;\n    this.$clearIcon = null;\n    this.$searchStatus = null;\n    this.$queryField = null;\n  }\n\n  /**\n   * @override Tree.js\n   */\n  _initKeyStrokeContext() {\n    super._initKeyStrokeContext();\n    this.searchFieldKeyStrokeContext = this._createKeyStrokeContextForSearchField();\n  }\n  _createKeyStrokeContextForSearchField() {\n    let keyStrokeContext = new InputFieldKeyStrokeContext();\n    keyStrokeContext.$scopeTarget = function () {\n      return this.$searchPanel;\n    }.bind(this);\n    keyStrokeContext.$bindTarget = function () {\n      return this.$queryField;\n    }.bind(this);\n    keyStrokeContext.registerStopPropagationKeys(keyStrokeModifier.NONE, [keys.ENTER, keys.BACKSPACE]);\n    return keyStrokeContext;\n  }\n  _render() {\n    super._render();\n\n    // Override layout\n    this.htmlComp.setLayout(new SearchOutlineLayout(this));\n    this.$container.addClass('search-outline');\n    this.$searchPanel = this.$container.prependDiv('search-outline-panel');\n    this.$queryField = this.$searchPanel.appendElement('<input>', 'search-outline-field').on('input', this._createOnQueryFieldInputFunction().bind(this)).on('keypress', this._onQueryFieldKeyPress.bind(this));\n    this.$clearIcon = this.$searchPanel.appendSpan('clear-icon unfocusable action text-field-icon').on('mousedown', this._onClearIconMouseDown.bind(this));\n    this.$searchStatus = this.$searchPanel.appendDiv('search-outline-status').on('mousedown', this._onTitleMouseDown.bind(this));\n    this.session.keyStrokeManager.installKeyStrokeContext(this.searchFieldKeyStrokeContext);\n  }\n  _remove() {\n    this.session.keyStrokeManager.uninstallKeyStrokeContext(this.searchFieldKeyStrokeContext);\n    this.$searchPanel.remove();\n    super._remove();\n  }\n  _renderProperties() {\n    super._renderProperties();\n    this._renderSearchQuery();\n    this._renderSearchStatus();\n    this._updateHasText();\n  }\n  _renderTitle() {\n    super._renderTitle();\n    // Move before search panel\n    if (this.titleVisible) {\n      this.$title.insertBefore(this.$searchPanel);\n    }\n  }\n  _renderSearchQuery() {\n    this.$queryField.val(this.searchQuery);\n  }\n  _renderSearchStatus() {\n    let animate = this.rendered;\n    if (this.searchStatus && !this.$searchStatus.isVisible()) {\n      if (animate) {\n        this.$searchStatus.slideDown({\n          duration: 200,\n          progress: this.revalidateLayout.bind(this)\n        });\n      } else {\n        this.$searchStatus.show();\n      }\n    } else if (!this.searchStatus && this.$searchStatus.isVisible()) {\n      if (animate) {\n        this.$searchStatus.slideUp({\n          duration: 200,\n          progress: this.revalidateLayout.bind(this)\n        });\n      } else {\n        this.$searchStatus.hide();\n      }\n    }\n    this.$searchStatus.textOrNbsp(this.searchStatus);\n    this.$searchPanel.toggleClass('has-status', !!this.searchStatus);\n  }\n  focusQueryField() {\n    this.validateFocus();\n  }\n  _triggerSearch() {\n    this.trigger('search', {\n      query: scout.nvl(this.searchQuery, '')\n    });\n  }\n  _createOnQueryFieldInputFunction(event) {\n    let debounceFunction = $.debounce(this._search.bind(this));\n    return function (event) {\n      this._updateHasText();\n      // debounced search\n      debounceFunction();\n    };\n  }\n  _onClearIconMouseDown(event) {\n    this.$queryField.val('');\n    this._updateHasText();\n    this._search();\n    // focus field if x is pressed when the field does not have the focus\n    this.$queryField.focus();\n    // stay in field when x is pressed\n    event.preventDefault();\n  }\n  _onQueryFieldKeyPress(event) {\n    if (event.which === keys.ENTER) {\n      this._setSearchQuery(this.$queryField.val());\n      this._triggerSearch();\n    }\n  }\n  _search(event) {\n    // Don't send query if value did not change (may happen when _createOnQueryFieldInputFunction is executed after _onQueryFieldKeyPress)\n    let searchQuery = this.$queryField.val();\n    if (this.searchQuery !== searchQuery) {\n      // Store locally so that the value persists when changing the outline without performing the search\n      this._setSearchQuery(searchQuery);\n      this._triggerSearch();\n    }\n  }\n  _setSearchQuery(searchQuery) {\n    this.searchQuery = searchQuery;\n  }\n  _updateHasText() {\n    this.$queryField.toggleClass('has-text', !!this.$queryField.val());\n  }\n\n  /**\n   * Focus and select content AFTER the search outline was rendered (and therefore the query field filled).\n   *\n   * @override Outline.js\n   */\n  validateFocus() {\n    if (!this.rendered) {\n      return;\n    }\n    let elementToFocus = this.$queryField[0];\n    if (this.session.focusManager.requestFocus(elementToFocus)) {\n      elementToFocus.select();\n    }\n  }\n}","map":{"version":3,"names":["InputFieldKeyStrokeContext","keys","keyStrokeModifier","Outline","scout","SearchOutlineLayout","$","SearchOutline","constructor","hasText","$searchPanel","$clearIcon","$searchStatus","$queryField","_initKeyStrokeContext","searchFieldKeyStrokeContext","_createKeyStrokeContextForSearchField","keyStrokeContext","$scopeTarget","bind","$bindTarget","registerStopPropagationKeys","NONE","ENTER","BACKSPACE","_render","htmlComp","setLayout","$container","addClass","prependDiv","appendElement","on","_createOnQueryFieldInputFunction","_onQueryFieldKeyPress","appendSpan","_onClearIconMouseDown","appendDiv","_onTitleMouseDown","session","keyStrokeManager","installKeyStrokeContext","_remove","uninstallKeyStrokeContext","remove","_renderProperties","_renderSearchQuery","_renderSearchStatus","_updateHasText","_renderTitle","titleVisible","$title","insertBefore","val","searchQuery","animate","rendered","searchStatus","isVisible","slideDown","duration","progress","revalidateLayout","show","slideUp","hide","textOrNbsp","toggleClass","focusQueryField","validateFocus","_triggerSearch","trigger","query","nvl","event","debounceFunction","debounce","_search","focus","preventDefault","which","_setSearchQuery","elementToFocus","focusManager","requestFocus","select"],"sources":["C:/workspace/ddhub/ddhub/node_modules/.pnpm/@eclipse-scout+core@22.0.41/node_modules/@eclipse-scout/core/src/desktop/outline/SearchOutline.js"],"sourcesContent":["/*\n * Copyright (c) 2010-2021 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {InputFieldKeyStrokeContext, keys, keyStrokeModifier, Outline, scout, SearchOutlineLayout} from '../../index';\nimport $ from 'jquery';\n\nexport default class SearchOutline extends Outline {\n\n  constructor() {\n    super();\n    this.hasText = false;\n    this.$searchPanel = null;\n    this.$clearIcon = null;\n    this.$searchStatus = null;\n    this.$queryField = null;\n  }\n\n  /**\n   * @override Tree.js\n   */\n  _initKeyStrokeContext() {\n    super._initKeyStrokeContext();\n\n    this.searchFieldKeyStrokeContext = this._createKeyStrokeContextForSearchField();\n  }\n\n  _createKeyStrokeContextForSearchField() {\n    let keyStrokeContext = new InputFieldKeyStrokeContext();\n    keyStrokeContext.$scopeTarget = function() {\n      return this.$searchPanel;\n    }.bind(this);\n    keyStrokeContext.$bindTarget = function() {\n      return this.$queryField;\n    }.bind(this);\n    keyStrokeContext.registerStopPropagationKeys(keyStrokeModifier.NONE, [\n      keys.ENTER, keys.BACKSPACE\n    ]);\n    return keyStrokeContext;\n  }\n\n  _render() {\n    super._render();\n\n    // Override layout\n    this.htmlComp.setLayout(new SearchOutlineLayout(this));\n\n    this.$container.addClass('search-outline');\n    this.$searchPanel = this.$container.prependDiv('search-outline-panel');\n    this.$queryField = this.$searchPanel.appendElement('<input>', 'search-outline-field')\n      .on('input', this._createOnQueryFieldInputFunction().bind(this))\n      .on('keypress', this._onQueryFieldKeyPress.bind(this));\n    this.$clearIcon = this.$searchPanel.appendSpan('clear-icon unfocusable action text-field-icon')\n      .on('mousedown', this._onClearIconMouseDown.bind(this));\n\n    this.$searchStatus = this.$searchPanel.appendDiv('search-outline-status')\n      .on('mousedown', this._onTitleMouseDown.bind(this));\n    this.session.keyStrokeManager.installKeyStrokeContext(this.searchFieldKeyStrokeContext);\n  }\n\n  _remove() {\n    this.session.keyStrokeManager.uninstallKeyStrokeContext(this.searchFieldKeyStrokeContext);\n    this.$searchPanel.remove();\n    super._remove();\n  }\n\n  _renderProperties() {\n    super._renderProperties();\n    this._renderSearchQuery();\n    this._renderSearchStatus();\n    this._updateHasText();\n  }\n\n  _renderTitle() {\n    super._renderTitle();\n    // Move before search panel\n    if (this.titleVisible) {\n      this.$title.insertBefore(this.$searchPanel);\n    }\n  }\n\n  _renderSearchQuery() {\n    this.$queryField.val(this.searchQuery);\n  }\n\n  _renderSearchStatus() {\n    let animate = this.rendered;\n\n    if (this.searchStatus && !this.$searchStatus.isVisible()) {\n      if (animate) {\n        this.$searchStatus.slideDown({\n          duration: 200,\n          progress: this.revalidateLayout.bind(this)\n        });\n      } else {\n        this.$searchStatus.show();\n      }\n    } else if (!this.searchStatus && this.$searchStatus.isVisible()) {\n      if (animate) {\n        this.$searchStatus.slideUp({\n          duration: 200,\n          progress: this.revalidateLayout.bind(this)\n        });\n      } else {\n        this.$searchStatus.hide();\n      }\n    }\n    this.$searchStatus.textOrNbsp(this.searchStatus);\n    this.$searchPanel.toggleClass('has-status', !!this.searchStatus);\n  }\n\n  focusQueryField() {\n    this.validateFocus();\n  }\n\n  _triggerSearch() {\n    this.trigger('search', {\n      query: scout.nvl(this.searchQuery, '')\n    });\n  }\n\n  _createOnQueryFieldInputFunction(event) {\n    let debounceFunction = $.debounce(this._search.bind(this));\n    return function(event) {\n      this._updateHasText();\n      // debounced search\n      debounceFunction();\n    };\n  }\n\n  _onClearIconMouseDown(event) {\n    this.$queryField.val('');\n    this._updateHasText();\n    this._search();\n    // focus field if x is pressed when the field does not have the focus\n    this.$queryField.focus();\n    // stay in field when x is pressed\n    event.preventDefault();\n  }\n\n  _onQueryFieldKeyPress(event) {\n    if (event.which === keys.ENTER) {\n      this._setSearchQuery(this.$queryField.val());\n      this._triggerSearch();\n    }\n  }\n\n  _search(event) {\n    // Don't send query if value did not change (may happen when _createOnQueryFieldInputFunction is executed after _onQueryFieldKeyPress)\n    let searchQuery = this.$queryField.val();\n    if (this.searchQuery !== searchQuery) {\n      // Store locally so that the value persists when changing the outline without performing the search\n      this._setSearchQuery(searchQuery);\n      this._triggerSearch();\n    }\n  }\n\n  _setSearchQuery(searchQuery) {\n    this.searchQuery = searchQuery;\n  }\n\n  _updateHasText() {\n    this.$queryField.toggleClass('has-text', !!this.$queryField.val());\n  }\n\n  /**\n   * Focus and select content AFTER the search outline was rendered (and therefore the query field filled).\n   *\n   * @override Outline.js\n   */\n  validateFocus() {\n    if (!this.rendered) {\n      return;\n    }\n    let elementToFocus = this.$queryField[0];\n    if (this.session.focusManager.requestFocus(elementToFocus)) {\n      elementToFocus.select();\n    }\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}