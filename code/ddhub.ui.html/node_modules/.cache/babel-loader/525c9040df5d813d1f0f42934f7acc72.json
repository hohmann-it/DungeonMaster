{"ast":null,"code":"/*\n * Copyright (c) 2010-2022 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { ClickActiveElementKeyStroke, CloseKeyStroke, FocusRule, GlassPaneRenderer, keys, KeyStrokeContext, scout, strings, Widget } from '../index';\nexport default class BusyIndicator extends Widget {\n  constructor() {\n    super();\n    this.cancellable = true;\n    this.showTimeout = 2500;\n    this.label = null;\n    this.details = null;\n    this.cancelButton = null;\n    this.boxButtons = null;\n    this.inheritAccessibility = false; // do not inherit enabled-state. BusyIndicator must always be enabled even if parent is disabled\n\n    this.$content = null;\n    this.$buttons = null;\n    this.$label = null;\n    this.$details = null;\n    this._addWidgetProperties(['boxButtons', 'cancelButton']);\n  }\n\n  /**\n   * @override\n   */\n  _createKeyStrokeContext() {\n    return new KeyStrokeContext();\n  }\n\n  /**\n   * @override\n   */\n  _initKeyStrokeContext() {\n    super._initKeyStrokeContext();\n    this.keyStrokeContext.registerKeyStroke([new ClickActiveElementKeyStroke(this, [keys.SPACE, keys.ENTER]), new CloseKeyStroke(this, () => {\n      if (!this.cancelButton) {\n        return null;\n      }\n      return this.cancelButton.$container;\n    })]);\n  }\n  _init(model) {\n    super._init(model);\n    this.label = scout.nvl(this.label, this.session.text('ui.PleaseWait_'));\n    if (this.cancellable) {\n      this.boxButtons = scout.create('BoxButtons', {\n        parent: this\n      });\n      this.cancelButton = this.boxButtons.addButton({\n        text: this.session.text('Cancel')\n      });\n      this.cancelButton.one('action', event => this._onCancelClick(event));\n    }\n  }\n  render($parent) {\n    // Use entry point by default\n    $parent = $parent || this.entryPoint();\n    super.render($parent);\n  }\n  _render() {\n    // Render busy indicator (still hidden by CSS, will be shown later in setTimeout.\n    // But don't use .hidden, otherwise the box' size cannot be calculated correctly!)\n    this.$container = this.$parent.appendDiv('busyindicator invisible');\n    let $handle = this.$container.appendDiv('drag-handle');\n    this.$container.draggable($handle);\n    this.$content = this.$container.appendDiv('busyindicator-content');\n    this.$label = this.$content.appendDiv('busyindicator-label');\n    this.$details = this.$content.appendDiv('busyindicator-details');\n    if (this.cancellable) {\n      this.boxButtons.render();\n      this.$buttons = this.boxButtons.$container;\n      this.$buttons.addClass('busyindicator-buttons');\n    } else {\n      this.$content.addClass('no-buttons');\n    }\n\n    // Render properties\n    this._renderLabel();\n    this._renderDetails();\n\n    // Prevent resizing when message-box is dragged off the viewport\n    this.$container.addClass('calc-helper');\n    this.$container.css('min-width', this.$container.width());\n    this.$container.removeClass('calc-helper');\n    // Now that all texts, paddings, widths etc. are set, we can calculate the position\n    this._position();\n\n    // Show busy box with a delay of 2.5 seconds (configurable by this.showTimeout).\n    this._busyIndicatorTimeoutId = setTimeout(() => {\n      this.$container.removeClass('invisible').addClassForAnimation('animate-open');\n      // Validate first focusable element\n      // Maybe, this is not required if problem with single-button form is solved (see FormController.js)\n      this.session.focusManager.validateFocus();\n    }, this.showTimeout);\n\n    // Render modality glass-panes\n    this._glassPaneRenderer = new GlassPaneRenderer(this);\n    this._glassPaneRenderer.renderGlassPanes();\n    this._glassPaneRenderer.eachGlassPane($glassPane => {\n      $glassPane.addClass('busy');\n    });\n  }\n  _postRender() {\n    super._postRender();\n    this.session.focusManager.installFocusContext(this.$container, FocusRule.AUTO);\n  }\n  _remove() {\n    // Remove busy box (cancel timer in case it was not fired yet)\n    clearTimeout(this._busyIndicatorTimeoutId);\n\n    // Remove glasspane\n    this._glassPaneRenderer.eachGlassPane($glassPane => {\n      $glassPane.removeClass('busy');\n    });\n    this._glassPaneRenderer.removeGlassPanes();\n    this.session.focusManager.uninstallFocusContext(this.$container);\n    super._remove();\n  }\n  setLabel(label) {\n    this.setProperty('label', label);\n  }\n  _renderLabel() {\n    this.$label.text(this.label || '');\n  }\n  setDetails(details) {\n    this.setProperty('details', details);\n  }\n  _renderDetails() {\n    this.$details.html(strings.nl2br(this.details)).setVisible(!!this.details);\n  }\n  _position() {\n    this.$container.cssMarginLeft(-this.$container.outerWidth() / 2);\n  }\n\n  /**\n   * Used by CloseKeyStroke.js\n   */\n  close() {\n    if (this.cancelButton && this.cancelButton.$container && this.session.focusManager.requestFocus(this.cancelButton.$container)) {\n      this.cancelButton.$container.focus();\n      this.cancelButton.doAction();\n    }\n  }\n  _onCancelClick(event) {\n    this.trigger('cancel', event);\n  }\n\n  /**\n   * Sets the busy indicator into cancelled state.\n   */\n  cancelled() {\n    if (this.rendered) {\n      // not closed yet\n      this.$label.addClass('cancelled');\n      if (this.$buttons) {\n        this.$buttons.remove();\n      }\n      this.$content.addClass('no-buttons');\n    }\n  }\n}","map":{"version":3,"names":["ClickActiveElementKeyStroke","CloseKeyStroke","FocusRule","GlassPaneRenderer","keys","KeyStrokeContext","scout","strings","Widget","BusyIndicator","constructor","cancellable","showTimeout","label","details","cancelButton","boxButtons","inheritAccessibility","$content","$buttons","$label","$details","_addWidgetProperties","_createKeyStrokeContext","_initKeyStrokeContext","keyStrokeContext","registerKeyStroke","SPACE","ENTER","$container","_init","model","nvl","session","text","create","parent","addButton","one","event","_onCancelClick","render","$parent","entryPoint","_render","appendDiv","$handle","draggable","addClass","_renderLabel","_renderDetails","css","width","removeClass","_position","_busyIndicatorTimeoutId","setTimeout","addClassForAnimation","focusManager","validateFocus","_glassPaneRenderer","renderGlassPanes","eachGlassPane","$glassPane","_postRender","installFocusContext","AUTO","_remove","clearTimeout","removeGlassPanes","uninstallFocusContext","setLabel","setProperty","setDetails","html","nl2br","setVisible","cssMarginLeft","outerWidth","close","requestFocus","focus","doAction","trigger","cancelled","rendered","remove"],"sources":["C:/git/d-d-hub/code/node_modules/.pnpm/@eclipse-scout+core@22.0.41/node_modules/@eclipse-scout/core/src/session/BusyIndicator.js"],"sourcesContent":["/*\n * Copyright (c) 2010-2022 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {ClickActiveElementKeyStroke, CloseKeyStroke, FocusRule, GlassPaneRenderer, keys, KeyStrokeContext, scout, strings, Widget} from '../index';\n\nexport default class BusyIndicator extends Widget {\n\n  constructor() {\n    super();\n    this.cancellable = true;\n    this.showTimeout = 2500;\n    this.label = null;\n    this.details = null;\n    this.cancelButton = null;\n    this.boxButtons = null;\n    this.inheritAccessibility = false; // do not inherit enabled-state. BusyIndicator must always be enabled even if parent is disabled\n\n    this.$content = null;\n    this.$buttons = null;\n    this.$label = null;\n    this.$details = null;\n\n    this._addWidgetProperties(['boxButtons', 'cancelButton']);\n  }\n\n  /**\n   * @override\n   */\n  _createKeyStrokeContext() {\n    return new KeyStrokeContext();\n  }\n\n  /**\n   * @override\n   */\n  _initKeyStrokeContext() {\n    super._initKeyStrokeContext();\n\n    this.keyStrokeContext.registerKeyStroke([\n      new ClickActiveElementKeyStroke(this, [\n        keys.SPACE, keys.ENTER\n      ]),\n      new CloseKeyStroke(this, (() => {\n        if (!this.cancelButton) {\n          return null;\n        }\n        return this.cancelButton.$container;\n      }))\n    ]);\n  }\n\n  _init(model) {\n    super._init(model);\n    this.label = scout.nvl(this.label, this.session.text('ui.PleaseWait_'));\n    if (this.cancellable) {\n      this.boxButtons = scout.create('BoxButtons', {parent: this});\n      this.cancelButton = this.boxButtons.addButton({text: this.session.text('Cancel')});\n      this.cancelButton.one('action', event => this._onCancelClick(event));\n    }\n  }\n\n  render($parent) {\n    // Use entry point by default\n    $parent = $parent || this.entryPoint();\n    super.render($parent);\n  }\n\n  _render() {\n    // Render busy indicator (still hidden by CSS, will be shown later in setTimeout.\n    // But don't use .hidden, otherwise the box' size cannot be calculated correctly!)\n    this.$container = this.$parent.appendDiv('busyindicator invisible');\n\n    let $handle = this.$container.appendDiv('drag-handle');\n    this.$container.draggable($handle);\n\n    this.$content = this.$container.appendDiv('busyindicator-content');\n    this.$label = this.$content.appendDiv('busyindicator-label');\n    this.$details = this.$content.appendDiv('busyindicator-details');\n\n    if (this.cancellable) {\n      this.boxButtons.render();\n      this.$buttons = this.boxButtons.$container;\n      this.$buttons.addClass('busyindicator-buttons');\n    } else {\n      this.$content.addClass('no-buttons');\n    }\n\n    // Render properties\n    this._renderLabel();\n    this._renderDetails();\n\n    // Prevent resizing when message-box is dragged off the viewport\n    this.$container.addClass('calc-helper');\n    this.$container.css('min-width', this.$container.width());\n    this.$container.removeClass('calc-helper');\n    // Now that all texts, paddings, widths etc. are set, we can calculate the position\n    this._position();\n\n    // Show busy box with a delay of 2.5 seconds (configurable by this.showTimeout).\n    this._busyIndicatorTimeoutId = setTimeout(() => {\n      this.$container.removeClass('invisible').addClassForAnimation('animate-open');\n      // Validate first focusable element\n      // Maybe, this is not required if problem with single-button form is solved (see FormController.js)\n      this.session.focusManager.validateFocus();\n    }, this.showTimeout);\n\n    // Render modality glass-panes\n    this._glassPaneRenderer = new GlassPaneRenderer(this);\n    this._glassPaneRenderer.renderGlassPanes();\n    this._glassPaneRenderer.eachGlassPane($glassPane => {\n      $glassPane.addClass('busy');\n    });\n  }\n\n  _postRender() {\n    super._postRender();\n    this.session.focusManager.installFocusContext(this.$container, FocusRule.AUTO);\n  }\n\n  _remove() {\n    // Remove busy box (cancel timer in case it was not fired yet)\n    clearTimeout(this._busyIndicatorTimeoutId);\n\n    // Remove glasspane\n    this._glassPaneRenderer.eachGlassPane($glassPane => {\n      $glassPane.removeClass('busy');\n    });\n    this._glassPaneRenderer.removeGlassPanes();\n    this.session.focusManager.uninstallFocusContext(this.$container);\n\n    super._remove();\n  }\n\n  setLabel(label) {\n    this.setProperty('label', label);\n  }\n\n  _renderLabel() {\n    this.$label.text(this.label || '');\n  }\n\n  setDetails(details) {\n    this.setProperty('details', details);\n  }\n\n  _renderDetails() {\n    this.$details\n      .html(strings.nl2br(this.details))\n      .setVisible(!!this.details);\n  }\n\n  _position() {\n    this.$container.cssMarginLeft(-this.$container.outerWidth() / 2);\n  }\n\n  /**\n   * Used by CloseKeyStroke.js\n   */\n  close() {\n    if (this.cancelButton && this.cancelButton.$container && this.session.focusManager.requestFocus(this.cancelButton.$container)) {\n      this.cancelButton.$container.focus();\n      this.cancelButton.doAction();\n    }\n  }\n\n  _onCancelClick(event) {\n    this.trigger('cancel', event);\n  }\n\n  /**\n   * Sets the busy indicator into cancelled state.\n   */\n  cancelled() {\n    if (this.rendered) { // not closed yet\n      this.$label.addClass('cancelled');\n      if (this.$buttons) {\n        this.$buttons.remove();\n      }\n      this.$content.addClass('no-buttons');\n    }\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}