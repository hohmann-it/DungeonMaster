{"ast":null,"code":"/*\n * Copyright (c) 2017 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Distribution License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/org/documents/edl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { arrays, Form, scout, Status } from '../../index';\nexport default class UnsavedFormChangesForm extends Form {\n  constructor() {\n    super();\n    this.unsavedForms = [];\n  }\n  _jsonModel() {\n    return {\n      id: 'scout.UnsavedFormChangesForm',\n      objectType: 'Form',\n      type: 'model',\n      title: '${textKey:SaveChangesOfSelectedItems}',\n      askIfNeedSave: false,\n      rootGroupBox: {\n        id: 'MainBox',\n        objectType: 'GroupBox',\n        menus: [{\n          id: 'OkMenu',\n          objectType: 'OkMenu'\n        }, {\n          id: 'CancelMenu',\n          objectType: 'CancelMenu'\n        }],\n        fields: [{\n          id: 'UnsavedChangesBox',\n          objectType: 'GroupBox',\n          labelVisible: false,\n          gridColumnCount: 1,\n          fields: [{\n            id: 'OpenFormsField',\n            objectType: 'ListBox',\n            gridDataHints: {\n              h: 5\n            },\n            labelVisible: false\n          }]\n        }]\n      }\n    };\n  }\n  _init(model) {\n    super._init(model);\n    this.openFormsField = this.widget('OpenFormsField');\n    this.openFormsField.setLookupCall(scout.create('scout.UnsavedFormsLookupCall', {\n      session: this.session,\n      unsavedForms: this.unsavedForms\n    }));\n    this.openFormsField.table.one('rowsInserted', event => {\n      event.source.checkAll(true);\n    });\n    let checkAllMenu = scout.create('Menu', {\n      parent: this.openFormsField.table,\n      id: 'CheckAllMenu',\n      menuTypes: ['Table.EmptySpace'],\n      text: '${textKey:CheckAll}'\n    });\n    checkAllMenu.on('action', event => {\n      this.openFormsField.table.checkAll(true);\n    });\n    let uncheckAllMenu = scout.create('Menu', {\n      parent: this.openFormsField.table,\n      id: 'UncheckAllMenu',\n      menuTypes: ['Table.EmptySpace'],\n      text: '${textKey:UncheckAll}'\n    });\n    uncheckAllMenu.on('action', event => {\n      this.openFormsField.table.uncheckAll();\n    });\n    this.openFormsField.table.setMenus([checkAllMenu, uncheckAllMenu]);\n    this.on('postLoad', event => {\n      this.touch();\n    });\n  }\n  _validate(data) {\n    let invalidForms = this.getInvalidForms();\n    if (invalidForms.length > 0) {\n      let msg = [];\n      msg.push('<p><b>', this.session.text('NotAllCheckedFormsCanBeSaved'), '</b></p>');\n      msg.push(this.session.text('FormsCannotBeSaved'), '<br><br>');\n      invalidForms.forEach(form => {\n        msg.push('- ', UnsavedFormChangesForm.getFormDisplayName(form), '<br>');\n      }, this);\n      return Status.error({\n        message: msg.join('')\n      });\n    }\n    return Status.ok();\n  }\n  getInvalidForms() {\n    let invalidForms = [];\n    this.openFormsField.value.forEach(form => {\n      let missingElements = form.lifecycle._invalidElements().missingElements.slice();\n      let invalidElements = form.lifecycle._invalidElements().invalidElements.slice();\n      form.visitDisplayChildren(dialog => {\n        let diagElem = dialog.lifecycle._invalidElements();\n        arrays.pushAll(missingElements, diagElem.missingElements);\n        arrays.pushAll(invalidElements, diagElem.invalidElements);\n      }, dialog => {\n        // forms are the only display children with a lifecycle, only visit those.\n        return dialog instanceof Form;\n      });\n      if (missingElements.length > 0 || invalidElements.length > 0) {\n        invalidForms.push(form);\n      }\n    });\n    return invalidForms;\n  }\n  static getFormDisplayName(form) {\n    return [form.title, form.name, form.subTitle].filter(Boolean).join(' - ');\n  }\n}","map":{"version":3,"names":["arrays","Form","scout","Status","UnsavedFormChangesForm","constructor","unsavedForms","_jsonModel","id","objectType","type","title","askIfNeedSave","rootGroupBox","menus","fields","labelVisible","gridColumnCount","gridDataHints","h","_init","model","openFormsField","widget","setLookupCall","create","session","table","one","event","source","checkAll","checkAllMenu","parent","menuTypes","text","on","uncheckAllMenu","uncheckAll","setMenus","touch","_validate","data","invalidForms","getInvalidForms","length","msg","push","forEach","form","getFormDisplayName","error","message","join","ok","value","missingElements","lifecycle","_invalidElements","slice","invalidElements","visitDisplayChildren","dialog","diagElem","pushAll","name","subTitle","filter","Boolean"],"sources":["C:/git/d-d-hub/code/node_modules/.pnpm/@eclipse-scout+core@22.0.41/node_modules/@eclipse-scout/core/src/desktop/unsavedchanges/UnsavedFormChangesForm.js"],"sourcesContent":["/*\n * Copyright (c) 2017 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Distribution License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/org/documents/edl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {arrays, Form, scout, Status} from '../../index';\n\nexport default class UnsavedFormChangesForm extends Form {\n\n  constructor() {\n    super();\n\n    this.unsavedForms = [];\n  }\n\n  _jsonModel() {\n    return {\n      id: 'scout.UnsavedFormChangesForm',\n      objectType: 'Form',\n      type: 'model',\n      title: '${textKey:SaveChangesOfSelectedItems}',\n      askIfNeedSave: false,\n      rootGroupBox: {\n        id: 'MainBox',\n        objectType: 'GroupBox',\n        menus: [{\n          id: 'OkMenu',\n          objectType: 'OkMenu'\n        }, {\n          id: 'CancelMenu',\n          objectType: 'CancelMenu'\n        }],\n        fields: [{\n          id: 'UnsavedChangesBox',\n          objectType: 'GroupBox',\n          labelVisible: false,\n          gridColumnCount: 1,\n          fields: [{\n            id: 'OpenFormsField',\n            objectType: 'ListBox',\n            gridDataHints: {\n              h: 5\n            },\n            labelVisible: false\n          }]\n        }]\n      }\n    };\n  }\n\n  _init(model) {\n    super._init(model);\n\n    this.openFormsField = this.widget('OpenFormsField');\n    this.openFormsField.setLookupCall(scout.create('scout.UnsavedFormsLookupCall', {\n      session: this.session,\n      unsavedForms: this.unsavedForms\n    }));\n\n    this.openFormsField.table.one('rowsInserted', event => {\n      event.source.checkAll(true);\n    });\n\n    let checkAllMenu = scout.create('Menu', {\n      parent: this.openFormsField.table,\n      id: 'CheckAllMenu',\n      menuTypes: ['Table.EmptySpace'],\n      text: '${textKey:CheckAll}'\n    });\n\n    checkAllMenu.on('action', event => {\n      this.openFormsField.table.checkAll(true);\n    });\n\n    let uncheckAllMenu = scout.create('Menu', {\n      parent: this.openFormsField.table,\n      id: 'UncheckAllMenu',\n      menuTypes: ['Table.EmptySpace'],\n      text: '${textKey:UncheckAll}'\n    });\n\n    uncheckAllMenu.on('action', event => {\n      this.openFormsField.table.uncheckAll();\n    });\n\n    this.openFormsField.table.setMenus([checkAllMenu, uncheckAllMenu]);\n\n    this.on('postLoad', event => {\n      this.touch();\n    });\n  }\n\n  _validate(data) {\n    let invalidForms = this.getInvalidForms();\n    if (invalidForms.length > 0) {\n      let msg = [];\n      msg.push('<p><b>', this.session.text('NotAllCheckedFormsCanBeSaved'), '</b></p>');\n      msg.push(this.session.text('FormsCannotBeSaved'), '<br><br>');\n      invalidForms.forEach(form => {\n        msg.push('- ', UnsavedFormChangesForm.getFormDisplayName(form), '<br>');\n      }, this);\n      return Status.error({\n        message: msg.join('')\n      });\n    }\n    return Status.ok();\n  }\n\n  getInvalidForms() {\n    let invalidForms = [];\n    this.openFormsField.value.forEach(form => {\n      let missingElements = form.lifecycle._invalidElements().missingElements.slice();\n      let invalidElements = form.lifecycle._invalidElements().invalidElements.slice();\n      form.visitDisplayChildren(dialog => {\n        let diagElem = dialog.lifecycle._invalidElements();\n        arrays.pushAll(missingElements, diagElem.missingElements);\n        arrays.pushAll(invalidElements, diagElem.invalidElements);\n      }, dialog => {\n        // forms are the only display children with a lifecycle, only visit those.\n        return dialog instanceof Form;\n      });\n      if (missingElements.length > 0 || invalidElements.length > 0) {\n        invalidForms.push(form);\n      }\n    });\n    return invalidForms;\n  }\n\n  static getFormDisplayName(form) {\n    return [form.title, form.name, form.subTitle].filter(Boolean).join(' - ');\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}