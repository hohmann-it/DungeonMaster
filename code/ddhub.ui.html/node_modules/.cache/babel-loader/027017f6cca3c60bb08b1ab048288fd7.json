{"ast":null,"code":"/*\n * Copyright (c) 2010-2022 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * https://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { Desktop, Device, PopupBlockerHandler, scout } from '../index';\nimport $ from 'jquery';\nexport default class OpenUriHandler {\n  init(model) {\n    this.session = model.session;\n  }\n  openUri(uri, action) {\n    $.log.isDebugEnabled() && $.log.debug('(OpenUriHandler#openUri) uri=' + uri + ' action=' + action);\n    if (!uri) {\n      return;\n    }\n    action = scout.nvl(action, Desktop.UriAction.OPEN);\n    if (action === Desktop.UriAction.DOWNLOAD) {\n      this.handleUriActionDownload(uri);\n    } else if (action === Desktop.UriAction.OPEN) {\n      this.handleUriActionOpen(uri);\n    } else if (action === Desktop.UriAction.NEW_WINDOW) {\n      this.handleUriActionNewWindow(uri);\n    } else if (action === Desktop.UriAction.POPUP_WINDOW) {\n      this.handleUriActionPopupWindow(uri);\n    } else if (action === Desktop.UriAction.SAME_WINDOW) {\n      this.handleUriActionSameWindow(uri);\n    }\n  }\n  handleUriActionDownload(uri) {\n    if (Device.get().isIos()) {\n      // The iframe trick does not work for ios\n      // Since the file cannot be stored on the file system it will be shown in the browser if possible\n      // -> create a new window to not replace the existing content.\n      // Drawback: Popup-Blocker will show up\n      // Opening in new window does not work in standalone mode because the window will be opened in safari which creates a new http session.\n      // Because the downloads are linked to the http session they cannot be downloaded using safari\n      if (Device.get().isStandalone()) {\n        this.openUriInSameWindow(uri);\n      } else {\n        this.openUriAsNewWindow(uri);\n      }\n    } else if (Device.get().browser === Device.Browser.CHROME && this.isUriWithExternallyHandledProtocol(uri)) {\n      // \"Hidden iframe\"-solution is not working in Chromium (https://bugs.chromium.org/p/chromium/issues/detail?id=663325)\n      this.openUriInSameWindow(uri);\n    } else {\n      this.openUriInIFrame(uri);\n    }\n  }\n  isUriWithExternallyHandledProtocol(uri) {\n    return /^(callto|facetime|fax|geo|mailto|maps|notes|sip|skype|tel|google.navigation|sms|msteams):/.test(uri);\n  }\n  handleUriActionOpen(uri) {\n    if (Device.get().isIos()) {\n      // Open in same window.\n      // Don't call _openUriInIFrame here, if action is set to open, an url is expected to be opened in the same window\n      // Additionally, some url types require to be opened in the same window like tel or mailto, at least on mobile devices\n      this.openUriInSameWindow(uri);\n    } else if (this.isUriWithExternallyHandledProtocol(uri)) {\n      if (Device.get().browser === Device.Browser.CHROME || Device.get().isAndroid()) {\n        // \"Hidden iframe\"-solution is not working in Chromium (https://bugs.chromium.org/p/chromium/issues/detail?id=663325)\n        this.openUriInSameWindow(uri);\n      } else {\n        // do not use sameWindow since the poller would be disconnected in firefox\n        this.openUriInIFrame(uri);\n      }\n    } else {\n      this.openUriAsNewWindow(uri);\n    }\n  }\n  handleUriActionNewWindow(uri) {\n    this.openUriAsNewWindow(uri);\n  }\n  handleUriActionPopupWindow(uri) {\n    this.openUriAsPopupWindow(uri);\n  }\n  handleUriActionSameWindow(uri) {\n    this.openUriInSameWindow(uri);\n  }\n  openUriInSameWindow(uri) {\n    window.location.assign(uri);\n  }\n  openUriInIFrame(uri) {\n    // Create a hidden iframe and set the URI as src attribute value\n    let $iframe = this.session.$entryPoint.appendElement('<iframe>', 'download-frame').attr('tabindex', -1).attr('src', uri);\n\n    // Remove the iframe again after 10s (should be enough to get the download started)\n    setTimeout(() => {\n      $iframe.remove();\n    }, 10 * 1000);\n  }\n  openUriAsNewWindow(uri) {\n    let popupBlockerHandler = scout.create('PopupBlockerHandler', {\n      session: this.session\n    });\n    popupBlockerHandler.openWindow(uri);\n  }\n  openUriAsPopupWindow(uri) {\n    let popupBlockerHandler = scout.create('PopupBlockerHandler', {\n      session: this.session\n    });\n    popupBlockerHandler.openWindow(uri, null, 'location=no,toolbar=no,menubar=no,resizable=yes,scrollbars=yes');\n  }\n}","map":{"version":3,"names":["Desktop","Device","PopupBlockerHandler","scout","$","OpenUriHandler","init","model","session","openUri","uri","action","log","isDebugEnabled","debug","nvl","UriAction","OPEN","DOWNLOAD","handleUriActionDownload","handleUriActionOpen","NEW_WINDOW","handleUriActionNewWindow","POPUP_WINDOW","handleUriActionPopupWindow","SAME_WINDOW","handleUriActionSameWindow","get","isIos","isStandalone","openUriInSameWindow","openUriAsNewWindow","browser","Browser","CHROME","isUriWithExternallyHandledProtocol","openUriInIFrame","test","isAndroid","openUriAsPopupWindow","window","location","assign","$iframe","$entryPoint","appendElement","attr","setTimeout","remove","popupBlockerHandler","create","openWindow"],"sources":["C:/git/d-d-hub/code/node_modules/.pnpm/@eclipse-scout+core@22.0.41/node_modules/@eclipse-scout/core/src/desktop/OpenUriHandler.js"],"sourcesContent":["/*\n * Copyright (c) 2010-2022 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * https://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {Desktop, Device, PopupBlockerHandler, scout} from '../index';\nimport $ from 'jquery';\n\nexport default class OpenUriHandler {\n\n  init(model) {\n    this.session = model.session;\n  }\n\n  openUri(uri, action) {\n    $.log.isDebugEnabled() && $.log.debug('(OpenUriHandler#openUri) uri=' + uri + ' action=' + action);\n    if (!uri) {\n      return;\n    }\n    action = scout.nvl(action, Desktop.UriAction.OPEN);\n\n    if (action === Desktop.UriAction.DOWNLOAD) {\n      this.handleUriActionDownload(uri);\n    } else if (action === Desktop.UriAction.OPEN) {\n      this.handleUriActionOpen(uri);\n    } else if (action === Desktop.UriAction.NEW_WINDOW) {\n      this.handleUriActionNewWindow(uri);\n    } else if (action === Desktop.UriAction.POPUP_WINDOW) {\n      this.handleUriActionPopupWindow(uri);\n    } else if (action === Desktop.UriAction.SAME_WINDOW) {\n      this.handleUriActionSameWindow(uri);\n    }\n  }\n\n  handleUriActionDownload(uri) {\n    if (Device.get().isIos()) {\n      // The iframe trick does not work for ios\n      // Since the file cannot be stored on the file system it will be shown in the browser if possible\n      // -> create a new window to not replace the existing content.\n      // Drawback: Popup-Blocker will show up\n      // Opening in new window does not work in standalone mode because the window will be opened in safari which creates a new http session.\n      // Because the downloads are linked to the http session they cannot be downloaded using safari\n      if (Device.get().isStandalone()) {\n        this.openUriInSameWindow(uri);\n      } else {\n        this.openUriAsNewWindow(uri);\n      }\n    } else if (Device.get().browser === Device.Browser.CHROME && this.isUriWithExternallyHandledProtocol(uri)) {\n      // \"Hidden iframe\"-solution is not working in Chromium (https://bugs.chromium.org/p/chromium/issues/detail?id=663325)\n      this.openUriInSameWindow(uri);\n    } else {\n      this.openUriInIFrame(uri);\n    }\n  }\n\n  isUriWithExternallyHandledProtocol(uri) {\n    return /^(callto|facetime|fax|geo|mailto|maps|notes|sip|skype|tel|google.navigation|sms|msteams):/.test(uri);\n  }\n\n  handleUriActionOpen(uri) {\n    if (Device.get().isIos()) {\n      // Open in same window.\n      // Don't call _openUriInIFrame here, if action is set to open, an url is expected to be opened in the same window\n      // Additionally, some url types require to be opened in the same window like tel or mailto, at least on mobile devices\n      this.openUriInSameWindow(uri);\n    } else if (this.isUriWithExternallyHandledProtocol(uri)) {\n      if (Device.get().browser === Device.Browser.CHROME || Device.get().isAndroid()) {\n        // \"Hidden iframe\"-solution is not working in Chromium (https://bugs.chromium.org/p/chromium/issues/detail?id=663325)\n        this.openUriInSameWindow(uri);\n      } else {\n        // do not use sameWindow since the poller would be disconnected in firefox\n        this.openUriInIFrame(uri);\n      }\n    } else {\n      this.openUriAsNewWindow(uri);\n    }\n  }\n\n  handleUriActionNewWindow(uri) {\n    this.openUriAsNewWindow(uri);\n  }\n\n  handleUriActionPopupWindow(uri) {\n    this.openUriAsPopupWindow(uri);\n  }\n\n  handleUriActionSameWindow(uri) {\n    this.openUriInSameWindow(uri);\n  }\n\n  openUriInSameWindow(uri) {\n    window.location.assign(uri);\n  }\n\n  openUriInIFrame(uri) {\n    // Create a hidden iframe and set the URI as src attribute value\n    let $iframe = this.session.$entryPoint.appendElement('<iframe>', 'download-frame')\n      .attr('tabindex', -1)\n      .attr('src', uri);\n\n    // Remove the iframe again after 10s (should be enough to get the download started)\n    setTimeout(() => {\n      $iframe.remove();\n    }, 10 * 1000);\n  }\n\n  openUriAsNewWindow(uri) {\n    let popupBlockerHandler = scout.create('PopupBlockerHandler', {session: this.session});\n    popupBlockerHandler.openWindow(uri);\n  }\n\n  openUriAsPopupWindow(uri) {\n    let popupBlockerHandler = scout.create('PopupBlockerHandler', {session: this.session});\n    popupBlockerHandler.openWindow(uri, null, 'location=no,toolbar=no,menubar=no,resizable=yes,scrollbars=yes');\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}