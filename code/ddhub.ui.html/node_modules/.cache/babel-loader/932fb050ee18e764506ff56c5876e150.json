{"ast":null,"code":"/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport { Dimension, graphics, HtmlEnvironment, PopupLayout, SmartFieldPopup } from '../../../index';\n\n/**\n * The popup layout is different from other layouts, since it can determine its own size\n * when the autoSize flag is set to true. Otherwise it uses the given size, like a regular\n * layout. The autoSize feature is used, when a child of the SmartFieldPopupLayout invalidates the\n * tree up to the popup. Since the popup is a validate root it must re-layout itself.\n * However: the size of the popup depends on the field it belongs to.\n *\n * The proposal-chooser DIV is not always present.\n */\nexport default class SmartFieldPopupLayout extends PopupLayout {\n  constructor(popup) {\n    super(popup);\n    this.animating = false;\n    this.doubleCalcPrefSize = false;\n  }\n  layout($container) {\n    let size,\n      popupSize,\n      htmlProposalChooser = this._htmlProposalChooser();\n\n    // skip layout while CSS animation is running (prefSize would not work while animation is running)\n    if (this.animating) {\n      this.popup.htmlComp.$comp.oneAnimationEnd(() => {\n        this.popup.revalidateLayout();\n      });\n      return;\n    }\n    super.layout($container);\n    popupSize = this.popup.htmlComp.size();\n    size = popupSize.subtract(this.popup.htmlComp.insets());\n    htmlProposalChooser.setSize(size);\n    if (this.popup.htmlComp.layouted) {\n      // Reposition because opening direction may have to be switched if popup gets bigger\n      // Don't do it the first time (will be done by popup.open), only if the popup is already\n      // open and gets layouted again\n      this.popup.position();\n    } else if (SmartFieldPopup.hasPopupAnimation()) {\n      // This code here is a bit complicated because:\n      // 1. we must position the scrollTo position before we start the animation\n      //    because it looks ugly, when we jump to the scroll position after the\n      //    animation has ended\n      // 2. we must first layout the popup with the table/tree correctly because\n      //    revealSelection doesn't work when popup has not the right size or is\n      //    not visible. That's why we must set the visibility to hidden.\n      // 3. we wait for the layout validator until the popup layout is validated\n      //    which means the scroll position is set correctly. Then we make the\n      //    popup visible again and start the animation (which shrinks the popup\n      //    to 1px height initially.\n      this.animating = true;\n      this.popup.htmlComp.$comp.css('visibility', 'hidden');\n      this.popup.session.layoutValidator.schedulePostValidateFunction(() => {\n        this.popup.htmlComp.$comp.css('visibility', '');\n        this.popup.htmlComp.$comp.addClassForAnimation('animate-open');\n        this.popup.htmlComp.$comp.oneAnimationEnd(() => {\n          this.animating = false;\n          this.popup._onAnimationEnd();\n        });\n      });\n    }\n  }\n\n  /**\n   * @override AbstractLayout.js\n   */\n  preferredLayoutSize($container, options) {\n    let prefSize,\n      htmlProposalChooser = this._htmlProposalChooser(),\n      fieldBounds = graphics.offsetBounds(this.popup.smartField.$field);\n    if (htmlProposalChooser) {\n      prefSize = htmlProposalChooser.prefSize(options);\n      prefSize = prefSize.add(this.popup.htmlComp.insets());\n    } else {\n      prefSize = new Dimension(HtmlEnvironment.get().formColumnWidth, HtmlEnvironment.get().formRowHeight * 2);\n    }\n    prefSize.width = Math.max(fieldBounds.width, prefSize.width);\n    prefSize.height = Math.max(15, Math.min(350, prefSize.height)); // at least some pixels height in case there is no data, no status, no active filter\n\n    if (prefSize.width > this._maxWindowSize()) {\n      prefSize.width = this._maxWindowSize();\n    }\n    return prefSize;\n  }\n  _htmlProposalChooser() {\n    let proposalChooser = this.popup.proposalChooser;\n    if (!proposalChooser) {\n      return null;\n    }\n    return proposalChooser.htmlComp;\n  }\n  _maxWindowSize() {\n    return this.popup.$container.window().width() - 2 * this.popup.windowPaddingX;\n  }\n}","map":{"version":3,"names":["Dimension","graphics","HtmlEnvironment","PopupLayout","SmartFieldPopup","SmartFieldPopupLayout","constructor","popup","animating","doubleCalcPrefSize","layout","$container","size","popupSize","htmlProposalChooser","_htmlProposalChooser","htmlComp","$comp","oneAnimationEnd","revalidateLayout","subtract","insets","setSize","layouted","position","hasPopupAnimation","css","session","layoutValidator","schedulePostValidateFunction","addClassForAnimation","_onAnimationEnd","preferredLayoutSize","options","prefSize","fieldBounds","offsetBounds","smartField","$field","add","get","formColumnWidth","formRowHeight","width","Math","max","height","min","_maxWindowSize","proposalChooser","window","windowPaddingX"],"sources":["C:/workspace/ddhub/ddhub/node_modules/.pnpm/@eclipse-scout+core@22.0.41/node_modules/@eclipse-scout/core/src/form/fields/smartfield/SmartFieldPopupLayout.js"],"sourcesContent":["/*\n * Copyright (c) 2014-2018 BSI Business Systems Integration AG.\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * which accompanies this distribution, and is available at\n * http://www.eclipse.org/legal/epl-v10.html\n *\n * Contributors:\n *     BSI Business Systems Integration AG - initial API and implementation\n */\nimport {Dimension, graphics, HtmlEnvironment, PopupLayout, SmartFieldPopup} from '../../../index';\n\n/**\n * The popup layout is different from other layouts, since it can determine its own size\n * when the autoSize flag is set to true. Otherwise it uses the given size, like a regular\n * layout. The autoSize feature is used, when a child of the SmartFieldPopupLayout invalidates the\n * tree up to the popup. Since the popup is a validate root it must re-layout itself.\n * However: the size of the popup depends on the field it belongs to.\n *\n * The proposal-chooser DIV is not always present.\n */\nexport default class SmartFieldPopupLayout extends PopupLayout {\n\n  constructor(popup) {\n    super(popup);\n\n    this.animating = false;\n    this.doubleCalcPrefSize = false;\n  }\n\n  layout($container) {\n    let size, popupSize,\n      htmlProposalChooser = this._htmlProposalChooser();\n\n    // skip layout while CSS animation is running (prefSize would not work while animation is running)\n    if (this.animating) {\n      this.popup.htmlComp.$comp.oneAnimationEnd(() => {\n        this.popup.revalidateLayout();\n      });\n      return;\n    }\n\n    super.layout($container);\n\n    popupSize = this.popup.htmlComp.size();\n    size = popupSize.subtract(this.popup.htmlComp.insets());\n    htmlProposalChooser.setSize(size);\n\n    if (this.popup.htmlComp.layouted) {\n      // Reposition because opening direction may have to be switched if popup gets bigger\n      // Don't do it the first time (will be done by popup.open), only if the popup is already\n      // open and gets layouted again\n      this.popup.position();\n    } else if (SmartFieldPopup.hasPopupAnimation()) {\n      // This code here is a bit complicated because:\n      // 1. we must position the scrollTo position before we start the animation\n      //    because it looks ugly, when we jump to the scroll position after the\n      //    animation has ended\n      // 2. we must first layout the popup with the table/tree correctly because\n      //    revealSelection doesn't work when popup has not the right size or is\n      //    not visible. That's why we must set the visibility to hidden.\n      // 3. we wait for the layout validator until the popup layout is validated\n      //    which means the scroll position is set correctly. Then we make the\n      //    popup visible again and start the animation (which shrinks the popup\n      //    to 1px height initially.\n      this.animating = true;\n      this.popup.htmlComp.$comp.css('visibility', 'hidden');\n\n      this.popup.session.layoutValidator.schedulePostValidateFunction(() => {\n        this.popup.htmlComp.$comp.css('visibility', '');\n        this.popup.htmlComp.$comp.addClassForAnimation('animate-open');\n        this.popup.htmlComp.$comp.oneAnimationEnd(() => {\n          this.animating = false;\n          this.popup._onAnimationEnd();\n        });\n      });\n    }\n  }\n\n  /**\n   * @override AbstractLayout.js\n   */\n  preferredLayoutSize($container, options) {\n    let prefSize,\n      htmlProposalChooser = this._htmlProposalChooser(),\n      fieldBounds = graphics.offsetBounds(this.popup.smartField.$field);\n\n    if (htmlProposalChooser) {\n      prefSize = htmlProposalChooser.prefSize(options);\n      prefSize = prefSize.add(this.popup.htmlComp.insets());\n    } else {\n      prefSize = new Dimension(\n        HtmlEnvironment.get().formColumnWidth,\n        HtmlEnvironment.get().formRowHeight * 2);\n    }\n\n    prefSize.width = Math.max(fieldBounds.width, prefSize.width);\n    prefSize.height = Math.max(15, Math.min(350, prefSize.height)); // at least some pixels height in case there is no data, no status, no active filter\n\n    if (prefSize.width > this._maxWindowSize()) {\n      prefSize.width = this._maxWindowSize();\n    }\n\n    return prefSize;\n  }\n\n  _htmlProposalChooser() {\n    let proposalChooser = this.popup.proposalChooser;\n    if (!proposalChooser) {\n      return null;\n    }\n    return proposalChooser.htmlComp;\n  }\n\n  _maxWindowSize() {\n    return this.popup.$container.window().width() - (2 * this.popup.windowPaddingX);\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}